<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Tom&#39;s code blog on Tom&#39;s code blog</title>
    <link>/</link>
    <description>Recent content in Tom&#39;s code blog on Tom&#39;s code blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 15 Apr 2019 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>map(expr) &#43; renderUI -&gt; dynamic shiny</title>
      <link>/2019/04/15/map-expr-renderui-dynamic-shiny/</link>
      <pubDate>Mon, 15 Apr 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/04/15/map-expr-renderui-dynamic-shiny/</guid>
      <description>


&lt;p&gt;I wrote my first shiny widget. A shiny widget is an html widget which uses shiny functions. In form it resembles a shiny app very closely, only the shinyApp function is wrapped in another function, which can take whatever arguments you like. More background can be found &lt;a href=&#34;https://bookdown.org/yihui/rmarkdown/shiny-widgets.html&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In order for the shiny widget to run, it needs a shiny runtime behind the document, which means it needs a server, just like a shiny app. For that reason, the widget it’s running in this actual document, it’s running on at &lt;a href=&#34;https://greenwood.shinyapps.io/filter_widget/#&#34;&gt;shinyapps.io&lt;/a&gt;. I’ve embedded it below.&lt;/p&gt;
&lt;iframe width=&#34;700&#34; height=&#34;400&#34; scrolling=&#34;yes&#34; frameborder=&#34;no&#34; src=&#34;https://greenwood.shinyapps.io/filter_widget/&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;Just a bit of explanation about how it works: The key is in mapping &lt;code&gt;checkboxGroupInput&lt;/code&gt; (or some other input function) across the names of the &lt;code&gt;data.frame&lt;/code&gt; passed to the widget. A slightly simpler version would be&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(shiny)
library(tidyverse, warn.conflicts = FALSE)

# invent some names
c(&amp;quot;john&amp;quot;, &amp;quot;paul&amp;quot;, &amp;quot;ringo&amp;quot;) %&amp;gt;%
# map a suitable shiny input across them
map(. %&amp;gt;% { expr(checkboxInput(!!., !!. )) } %&amp;gt;%  eval ) %&amp;gt;% 
tagList &lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;john&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;john&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;paul&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;paul&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;ringo&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;ringo&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Let’s break this down one step further. First, why use tagList? Well, because &lt;code&gt;map&lt;/code&gt; returns a list, and we don’t want a list, we wants legit html. To see the hmtl in markdown without it rendering need a bit of a workaround, so the next code chunk isn’t actually run, but if you run&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;checkboxInput(&amp;quot;john&amp;quot;, &amp;quot;john&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In an R console, what you get is&lt;/p&gt;
&lt;pre class=&#34;html&#34;&gt;&lt;code&gt;&amp;lt;div class=&amp;quot;form-group shiny-input-container&amp;quot;&amp;gt;
  &amp;lt;div class=&amp;quot;checkbox&amp;quot;&amp;gt;
    &amp;lt;label&amp;gt;
      &amp;lt;input id=&amp;quot;john&amp;quot; type=&amp;quot;checkbox&amp;quot;/&amp;gt;
      &amp;lt;span&amp;gt;john&amp;lt;/span&amp;gt;
    &amp;lt;/label&amp;gt;
  &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I know I don’t actually use tagList in the widget, I use renderUI, but they’re performing the same role there. In the shinywidget it needs renderUI, but in markdown, outside of a widget you could tagList.&lt;/p&gt;
&lt;p&gt;So, mapping &lt;code&gt;checkboxInput&lt;/code&gt; across a list of names gives you a list of chunks of html. &lt;code&gt;tagList&lt;/code&gt; just combines a list of chunks of html into one big chunk, without it, you just get the html from the last element of the list (I’m not sure why).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;list(checkboxInput(&amp;quot;john&amp;quot;, &amp;quot;john&amp;quot;), 
        checkboxInput(&amp;quot;paul&amp;quot;, &amp;quot;paul&amp;quot;),
        checkboxInput(&amp;quot;ringo&amp;quot;, &amp;quot;ringo&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## &amp;lt;div class=&amp;quot;form-group shiny-input-container&amp;quot;&amp;gt;
##   &amp;lt;div class=&amp;quot;checkbox&amp;quot;&amp;gt;
##     &amp;lt;label&amp;gt;
##       &amp;lt;input id=&amp;quot;john&amp;quot; type=&amp;quot;checkbox&amp;quot;/&amp;gt;
##       &amp;lt;span&amp;gt;john&amp;lt;/span&amp;gt;
##     &amp;lt;/label&amp;gt;
##   &amp;lt;/div&amp;gt;
## &amp;lt;/div&amp;gt;
## 
## [[2]]
## &amp;lt;div class=&amp;quot;form-group shiny-input-container&amp;quot;&amp;gt;
##   &amp;lt;div class=&amp;quot;checkbox&amp;quot;&amp;gt;
##     &amp;lt;label&amp;gt;
##       &amp;lt;input id=&amp;quot;paul&amp;quot; type=&amp;quot;checkbox&amp;quot;/&amp;gt;
##       &amp;lt;span&amp;gt;paul&amp;lt;/span&amp;gt;
##     &amp;lt;/label&amp;gt;
##   &amp;lt;/div&amp;gt;
## &amp;lt;/div&amp;gt;
## 
## [[3]]
## &amp;lt;div class=&amp;quot;form-group shiny-input-container&amp;quot;&amp;gt;
##   &amp;lt;div class=&amp;quot;checkbox&amp;quot;&amp;gt;
##     &amp;lt;label&amp;gt;
##       &amp;lt;input id=&amp;quot;ringo&amp;quot; type=&amp;quot;checkbox&amp;quot;/&amp;gt;
##       &amp;lt;span&amp;gt;ringo&amp;lt;/span&amp;gt;
##     &amp;lt;/label&amp;gt;
##   &amp;lt;/div&amp;gt;
## &amp;lt;/div&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;v.s.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tagList(checkboxInput(&amp;quot;john&amp;quot;, &amp;quot;john&amp;quot;), 
        checkboxInput(&amp;quot;paul&amp;quot;, &amp;quot;paul&amp;quot;),
        checkboxInput(&amp;quot;ringo&amp;quot;, &amp;quot;ringo&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;john&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;john&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;paul&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;paul&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;form-group shiny-input-container&#34;&gt;
&lt;div class=&#34;checkbox&#34;&gt;
&lt;label&gt;
&lt;input id=&#34;ringo&#34; type=&#34;checkbox&#34;/&gt;
&lt;span&gt;ringo&lt;/span&gt;
&lt;/label&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;And finally, good ol’ map(expr), which makes it easy to create any list of expressions you want.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;letters[1:5] %&amp;gt;% map(~ expr(selectInput(!!., !!., choices = c(TRUE, FALSE))))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## selectInput(&amp;quot;a&amp;quot;, &amp;quot;a&amp;quot;, choices = c(TRUE, FALSE))
## 
## [[2]]
## selectInput(&amp;quot;b&amp;quot;, &amp;quot;b&amp;quot;, choices = c(TRUE, FALSE))
## 
## [[3]]
## selectInput(&amp;quot;c&amp;quot;, &amp;quot;c&amp;quot;, choices = c(TRUE, FALSE))
## 
## [[4]]
## selectInput(&amp;quot;d&amp;quot;, &amp;quot;d&amp;quot;, choices = c(TRUE, FALSE))
## 
## [[5]]
## selectInput(&amp;quot;e&amp;quot;, &amp;quot;e&amp;quot;, choices = c(TRUE, FALSE))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And that’s it!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>model tuning with automl in auto-sklearn: Part 1</title>
      <link>/2019/03/17/model-tuning-with-automl-in-auto-sklearn-part1/</link>
      <pubDate>Sun, 17 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/03/17/model-tuning-with-automl-in-auto-sklearn-part1/</guid>
      <description>


&lt;p&gt;I went to a talk at Bristech on the subject of autoML in Azure. I have to say I was pretty convinced the autoML is the future. Azure’s autoML is built on sklearn (and therefore it’s a python-only SDK), so I did a big of googling and it turns out the autoML with sklearn is actually open-source. You just need to install the ‘auto’sklearn’ package onto your computer and you’re good to go.&lt;/p&gt;
&lt;p&gt;A few provisos with installing auto-sklean.&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;You need a linux environment to run it. My laptop runs Ubuntu, so I didn’t need to do anything but if you’re not on linux then you’ll need a VM (or a container).&lt;/li&gt;
&lt;li&gt;The dependencies might clash with other versions of packages you have installed. E.g. I had a different version of pandas or numpy or something and, although I went through the auto-sklearn intallation step detailed &lt;a href=&#34;https://automl.github.io/auto-sklearn/stable/installation.html&#34;&gt;here&lt;/a&gt; (yes, auto-sklearn has a very useful website) it wouldn’t run. The way to solve this is to create a fresh environment (I use conda) with&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;bash&#34;&gt;&lt;code&gt;conda create -n automl python=3.6
conda activate automl&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then follow the installation instructions from the command line and you’ll get an environment excactly as auto-sklearn wants it. Once that’s done, start a python session from within your automl environment and run the auto-sklearn example.&lt;/p&gt;
&lt;p&gt;As a side point, since I’m actually running this example from within an rmarkdown document, and the python engine for rmakdown is provided by the reticulate package, I’ll tell reticulate with conda env to use to the run the python code.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(reticulate)
use_condaenv(condaenv = &amp;quot;automl&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;
import autosklearn.classification
import sklearn.model_selection
import sklearn.datasets
import sklearn.metrics
X, y = sklearn.datasets.load_digits(return_X_y=True)
X_train, X_test, y_train, y_test = \
    sklearn.model_selection.train_test_split(X, y, random_state=1)
automl = autosklearn.classification.AutoSklearnClassifier()
automl.fit(X_train, y_train)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [WARNING] [2019-03-17 18:25:11,588:smac.intensification.intensification.Intensifier] Challenger was the same as the current incumbent; Skipping challenger
## [WARNING] [2019-03-17 18:25:11,588:smac.intensification.intensification.Intensifier] Challenger was the same as the current incumbent; Skipping challenger
## AutoSklearnClassifier(delete_output_folder_after_terminate=True,
##            delete_tmp_folder_after_terminate=True,
##            disable_evaluator_output=False, ensemble_memory_limit=1024,
##            ensemble_nbest=50, ensemble_size=50, exclude_estimators=None,
##            exclude_preprocessors=None, get_smac_object_callback=None,
##            include_estimators=None, include_preprocessors=None,
##            initial_configurations_via_metalearning=25, logging_config=None,
##            ml_memory_limit=3072, n_jobs=None, output_folder=None,
##            per_run_time_limit=360, resampling_strategy=&amp;#39;holdout&amp;#39;,
##            resampling_strategy_arguments=None, seed=1, shared_mode=False,
##            smac_scenario_args=None, time_left_for_this_task=3600,
##            tmp_folder=None)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;y_hat = automl.predict(X_test)
print(&amp;quot;Accuracy score&amp;quot;, sklearn.metrics.accuracy_score(y_test, y_hat))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Accuracy score 0.9866666666666667&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The automl.fit takes about an hour to run, and I’m actually running it in rmarkdown, for the blog page, so the page take ages to render. Now, the model you’ll get is a pretty large object (the one I got is roughly 500MB), and since it took an hour to build, you’ll probably want to save the model object with.&lt;/p&gt;
&lt;pre class=&#34;python&#34;&gt;&lt;code&gt;filename = &amp;quot;automl_test_model.sav&amp;quot;
pickle.dump(automl, open(filename, &amp;#39;wb&amp;#39;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and it’s that simple! Actually auto-sklearn has a lot of other options for specficying which cross-validation method to use, and how long to test different models for etc. But like I said, this page already takes and hour to render, so I think other examples with have to be or another post.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>shiny modules part 1.</title>
      <link>/2019/02/27/shiny-modules-part-1/</link>
      <pubDate>Wed, 27 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/27/shiny-modules-part-1/</guid>
      <description>


&lt;p&gt;I’ve been wanting to learn about shiny modules ever since my shiny-building Italian colleague, Dan, pointed out that they might be a good way to keep the code more organised for bigger apps. My first try was overly ambitious and ended in an untagleable mess of modules within modules that didn’t run, so I decided to go with something nice and simple first off, and build from there. In fact, I’d say that’s a principle I’m sticking with from now on when it comes to building apps: start with something simple and add complexity. It makes de-bugging way easier.&lt;/p&gt;
&lt;p&gt;Anyway, for those that don’t know, a ‘module’ in shiny is a bit like a function that creates a bit of UI and the server code that goes with that UI. Of course, if you tried to write a function to make those things normally, you’d hit the problem of duplicate input and output names, which will break the app. What modules do is they create distinct namespaces for each time the module is called, so you don’t get the clash of input and output names. This is great for:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;When your app code would involve lots of repetition (this is the case with my example app)&lt;/li&gt;
&lt;li&gt;When you want the user to be able to create additional parts of the UI themselves. This is potentially the more poweful use IMO, but it’s more complicated, so hopefully I’ll cover that in another blog.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Anyway here’s the module is used&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;compare3dsUI &amp;lt;- function(id) {
  
  ns &amp;lt;- NS(id)
  
 tagList(
   fluidRow(
     column(6, 
      selectInput(inputId =  ns(&amp;quot;follow&amp;quot;), 
                  label = &amp;quot;highlight one country&amp;quot;,
                  choices = gapminder$country %&amp;gt;% unique %&amp;gt;% sort 
                  )
      ),
     column(6,
       sliderTextInput(inputId = ns(&amp;quot;year&amp;quot;),
                       label = &amp;quot;year&amp;quot;, 
                       choices = gapminder$year %&amp;gt;% unique,
                       animate = animationOptions(interval = 2000)
            )
   )
          ), 
   fluidRow(
      column(6, plotlyOutput(ns(&amp;quot;contplot&amp;quot;))),
      column(6, plotlyOutput(ns(&amp;quot;worldplot&amp;quot;)))
   )
)
  
}

compare3ds &amp;lt;- function(input, output, session, cont) {
  
  cont_counts &amp;lt;- reactive({ gapminder %&amp;gt;% filter(continent == cont) %&amp;gt;% 
                                          pull(country)  })
  
  yearData &amp;lt;- reactive({gapminder %&amp;gt;%
                   mutate(colour = if_else(continent == cont, 1, 2) %&amp;gt;%
                                   {if_else(country == input$follow, 3, .)}
                          ) %&amp;gt;%
                   filter(year == input$year)
                   
  })
  
  output$contplot &amp;lt;- renderPlotly(yearData() %&amp;gt;% filter(continent == cont) %&amp;gt;% 
                                    plot_3d(lifeExp, pop, gdpPercap, 
                                            text = country,
                                            title = cont,
                                            color = colour,
                                            colors = if (input$follow %in% cont_counts()) {
                                                             c(&amp;quot;red&amp;quot;, &amp;quot;blue&amp;quot;) } else {
                                                               &amp;quot;red&amp;quot; } 
                                            
                                          )
  )
  
  output$worldplot &amp;lt;- renderPlotly(yearData() %&amp;gt;% 
                                     plot_3d(lifeExp, pop, gdpPercap, 
                                             text = country,
                                             title = &amp;quot;World&amp;quot;,
                                             color = colour,
                                             colors = c(&amp;quot;red&amp;quot;, &amp;quot;grey&amp;quot;, &amp;quot;blue&amp;quot;)
                                          )
  )
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It could be re-written a lot more generic, which would allow it to be used in other apps, but it was late at night when I wrote it and I just couldn’t be bothered. Basically, all you’d need to do it add a load more function arguments in the ‘server’ part of the module for things like colour and variable names etc, and then take those out of the function expression. It uses the plot3d function from &lt;a href=&#34;http://greenwood.rocks/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/&#34;&gt;this blog post&lt;/a&gt;. Then the app UI itself is just:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;source(&amp;quot;compare3ds.R&amp;quot;)

ui &amp;lt;- navbarPage(&amp;quot;Gapminder modules&amp;quot;, theme = &amp;quot;bootstrap.css&amp;quot;,

        tabPanel(title = &amp;quot;Africa&amp;quot;, 
                 compare3dsUI(&amp;quot;Africa&amp;quot;)
              ),
        tabPanel(title = &amp;quot;Europe&amp;quot;, 
                 compare3dsUI(&amp;quot;Europe&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Americas&amp;quot;, 
                 compare3dsUI(&amp;quot;Americas&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Oceania&amp;quot;, 
                 compare3dsUI(&amp;quot;Oceania&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Asia&amp;quot;, 
                 compare3dsUI(&amp;quot;Asia&amp;quot;)
        )
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the server function is just&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Define server logic required to draw a histogram
server &amp;lt;- function(input, output, session) {
  
  Africa &amp;lt;- callModule(compare3ds, &amp;quot;Africa&amp;quot;, cont = &amp;quot;Africa&amp;quot;)
  Europe &amp;lt;- callModule(compare3ds, &amp;quot;Europe&amp;quot;, cont = &amp;quot;Europe&amp;quot;)
  Americas &amp;lt;- callModule(compare3ds, &amp;quot;Americas&amp;quot;, cont = &amp;quot;Americas&amp;quot;)
  Oceania &amp;lt;- callModule(compare3ds, &amp;quot;Oceania&amp;quot;, cont = &amp;quot;Oceania&amp;quot;)
  Asia &amp;lt;- callModule(compare3ds, &amp;quot;Asia&amp;quot;, cont = &amp;quot;Asia&amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, basically it save a LOT of typing. Plus it means you can make changes to the module and those changes are replicated. Like I say, I think the real value will be when you combine it will actionButton + insertUI and things like that. I also think that it’s one of those things that once you start using, you’ll never go back, because it just saves you time and keeps your code more compartmentalised, which is all good.&lt;/p&gt;
&lt;p&gt;Here’s the app on shinyapps.io. It’s basically a take on Hans Rosling famous animation, but in 3d and with less data. If only the gapminder package just gave you a bit more up-to-date data that would be nice, I’d like to see how things have changed since 2007.&lt;/p&gt;
&lt;iframe width=&#34;700&#34; height=&#34;400&#34; scrolling=&#34;yes&#34; frameborder=&#34;no&#34; src=&#34;https://greenwood.shinyapps.io/gap_mod/&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;It’s a bit clipped, but you can see the full page &lt;a href=&#34;https://greenwood.shinyapps.io/gap_mod/&#34;&gt;here&lt;/a&gt;. Once I’ve figured out some useful application of nested modules I’ll post it as part 2.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>visualising models in 3d with plotly and nse functions</title>
      <link>/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/</link>
      <pubDate>Sat, 09 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/plotly-binding/plotly.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/typedarray/typedarray.min.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/jquery/jquery.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/crosstalk/css/crosstalk.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/crosstalk/js/crosstalk.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/plotly-main/plotly-latest.min.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;One of the areas I’m planning to improve on is visualisation. Ultimately, this means D3, but in the meantime I wrote a fairly useful function for showing the fit of a model with two inputs, along with the data, using plotly. First, load the necessary libraries:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(plotly)
library(randomForest)
library(rlang)
library(dplyr)
library(magrittr)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(you could actually write thing function without rlang or magrittr, but it’s just a bit neater with them.) Here’s the function:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_3d &amp;lt;- function(df, x, y, z) {
  
  x &amp;lt;- enquo(x)
  y &amp;lt;- enquo(y)
  z &amp;lt;- enquo(z) 
  
  # build a model 
  m &amp;lt;- randomForest(expr(!!get_expr(x) ~ !!get_expr(y) + !!get_expr(z)) %&amp;gt;% as.formula, df)
  
  # add the predictions to df
  df %&amp;lt;&amp;gt;% mutate(preds = predict(m, newdata = df ))
  
  plot_ly(df) %&amp;gt;%
    add_trace(x = x, y = y, z = z, 
                opacity = 0.7,
                type = &amp;quot;scatter3d&amp;quot;, 
                mode = &amp;quot;markers&amp;quot;,
                colors = c(&amp;quot;grey&amp;quot;, &amp;quot;blue&amp;quot;),
                name = &amp;quot;true values&amp;quot;,
                size = 10
              ) %&amp;gt;%
    add_trace(x = ~preds, y = y, z = z,
                opacity = 0.7,
                type = &amp;quot;scatter3d&amp;quot;, 
                mode = &amp;quot;markers&amp;quot;,
                name = &amp;quot;modelled values&amp;quot;,
                size = 10
                ) %&amp;gt;%
    layout(scene = list(xaxis = list(title = quo_text(x)),
                        yaxis = list(title = quo_text(y)),
                        zaxis = list(title = quo_text(z))
    )
    )
  
}

economics %&amp;gt;% plot_3d(pce, psavert, uempmed)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:672px;height:480px;&#34; class=&#34;plotly html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;visdat&#34;:{&#34;48a329922cd2&#34;:[&#34;function () &#34;,&#34;plotlyVisDat&#34;]},&#34;cur_data&#34;:&#34;48a329922cd2&#34;,&#34;attrs&#34;:{&#34;48a329922cd2&#34;:{&#34;alpha_stroke&#34;:1,&#34;sizes&#34;:[10,100],&#34;spans&#34;:[1,20],&#34;x&#34;:{},&#34;y&#34;:{},&#34;z&#34;:{},&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;colors&#34;:[&#34;grey&#34;,&#34;blue&#34;],&#34;name&#34;:&#34;true values&#34;,&#34;size&#34;:10,&#34;inherit&#34;:true},&#34;48a329922cd2.1&#34;:{&#34;alpha_stroke&#34;:1,&#34;sizes&#34;:[10,100],&#34;spans&#34;:[1,20],&#34;x&#34;:{},&#34;y&#34;:{},&#34;z&#34;:{},&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;modelled values&#34;,&#34;size&#34;:10,&#34;inherit&#34;:true}},&#34;layout&#34;:{&#34;margin&#34;:{&#34;b&#34;:40,&#34;l&#34;:60,&#34;t&#34;:25,&#34;r&#34;:10},&#34;scene&#34;:{&#34;xaxis&#34;:{&#34;title&#34;:&#34;pce&#34;},&#34;yaxis&#34;:{&#34;title&#34;:&#34;psavert&#34;},&#34;zaxis&#34;:{&#34;title&#34;:&#34;uempmed&#34;}},&#34;hovermode&#34;:&#34;closest&#34;,&#34;showlegend&#34;:true},&#34;source&#34;:&#34;A&#34;,&#34;config&#34;:{&#34;modeBarButtonsToAdd&#34;:[{&#34;name&#34;:&#34;Collaborate&#34;,&#34;icon&#34;:{&#34;width&#34;:1000,&#34;ascent&#34;:500,&#34;descent&#34;:-50,&#34;path&#34;:&#34;M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z&#34;},&#34;click&#34;:&#34;function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == &#39;?viewer_pane=1&#39;) {\n          alert(&#39;To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html&#39;);\n        } else {\n          window.open(&#39;https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html&#39;, &#39;_blank&#39;);\n        }\n      }&#34;}],&#34;cloud&#34;:false},&#34;data&#34;:[{&#34;x&#34;:[507.4,510.5,516.3,512.9,518.1,525.8,531.5,534.2,544.9,544.6,550.4,556.8,563.8,567.6,568.8,572.3,577.4,577.2,584.2,589.5,589.7,594.7,601.1,601.7,603.5,610.8,614.1,619.4,621.4,623.7,629.6,634.9,633.2,637,643.4,647.2,649.5,653.9,660.1,659.3,657.6,666.6,677.2,680.4,683,689.8,692.2,700.8,699.9,706,714.1,716.9,722.1,729.6,732.6,737.3,750.4,753.8,759.2,762.9,771.2,777.7,782.5,796.3,801.8,807.5,817.9,827.2,834.2,837.2,843.1,845.8,855.7,854.9,870.9,869.8,878.6,878.4,886.4,891.6,903.3,912.7,924.3,929.9,939.8,956.6,956.8,961,958,963.6,977.4,991.3,992.6,997.2,1021.2,1029.1,1042.2,1049.4,1057.2,1063.2,1078,1094.4,1109.5,1110.1,1117.3,1127.8,1125.1,1142.9,1152.1,1160.5,1171.4,1179.5,1191.7,1214.1,1217.4,1233.7,1240.7,1249.7,1259.6,1266.3,1283.2,1288.5,1297.4,1314.3,1330,1339.3,1333,1358.9,1381.4,1400.2,1415.9,1429.8,1430.8,1451,1456.9,1471,1484.7,1500.5,1506.3,1521.6,1535,1542.3,1562.7,1579.6,1590.1,1619.7,1638.1,1646,1661.7,1670.7,1701.6,1705.6,1712.4,1699.5,1704.3,1723,1751.2,1767.7,1784.1,1820.4,1830.2,1855.5,1874.7,1889.4,1908.1,1909.1,1918.2,1938.5,1945.7,1969.8,1968.2,1966.2,1972.4,1989.9,1997.4,2021.4,2024.4,2027.2,2045.9,2050.2,2075.1,2083.7,2108.9,2130.7,2154.7,2167.4,2180.1,2183.1,2208.6,2231.8,2251,2280.8,2309,2324.8,2339.1,2361.8,2370.4,2397.9,2423.8,2408.1,2436.4,2462.6,2479.8,2501.2,2500.5,2518.4,2540.3,2538.2,2578.6,2590,2626.3,2648.6,2656.8,2668.4,2705.9,2699.3,2725.9,2762.7,2805.6,2767.1,2782.7,2822.8,2838.3,2831.2,2834.7,2846.5,2869,2873.5,2893.4,2911.1,2984.6,2945.9,2941.7,3010.8,2949.9,3016.5,3028.4,3054.1,3063.9,3088.4,3110.7,3147,3142.9,3151.1,3160.9,3190.9,3230.7,3238.5,3277.8,3280.4,3311,3335.6,3359.3,3384.3,3391.4,3430.4,3447,3476.3,3499.9,3503.9,3514.5,3558.6,3567.5,3582.4,3601.7,3636.8,3638.1,3650,3659.7,3700.7,3747.2,3744.8,3771.5,3786.7,3792.5,3821.3,3838.5,3865,3886.7,3887.1,3888.4,3877.8,3857.6,3883.3,3929.7,3923.9,3950,3957.1,3982.4,3985.4,4001.2,3992.9,4020.6,4037.7,4101.9,4116.8,4134.3,4149,4176.1,4195,4223,4239.3,4273.9,4303.5,4319.5,4355.6,4359.7,4374.3,4371.4,4412.4,4441.3,4458.8,4487.7,4499.9,4530.5,4552,4573.4,4590.7,4604.8,4652.3,4665.4,4690.7,4689.2,4728.8,4740.8,4783,4795.5,4833.3,4846,4862.3,4871.9,4871.7,4906.5,4911.5,4954.4,4999,4991.8,5027.1,5042.5,5035.9,5077.8,5120.1,5108.9,5156.1,5196.4,5231.6,5247.2,5253.7,5275.8,5299,5320,5351.5,5375,5401.7,5434.9,5457.7,5477.6,5482.8,5484.3,5518.2,5573,5611.8,5625.6,5661.2,5685.2,5716.4,5714.4,5748.4,5775,5812.9,5863.3,5897.2,5915.6,5951,5991.8,6025.8,6042.7,6098.2,6099.1,6128.2,6159.7,6223.6,6253.4,6281.9,6309.5,6354.8,6407.4,6431.2,6467.2,6568.2,6564.7,6648.7,6714.8,6701,6737.2,6773.6,6793.7,6828.7,6913.1,6919.6,6934.5,6979.1,7009.8,7029.3,7022.1,7036.2,7083.1,7097.1,7109.2,7146.1,7054.8,7250.2,7209.6,7190,7217.7,7259.7,7276.7,7345.6,7321.8,7366.1,7424.2,7449,7426.1,7469.3,7499.8,7552.6,7579.5,7573.6,7627.5,7661.7,7669.2,7722.9,7783.8,7878.9,7874,7890.6,7950.4,7974.3,8037.3,8072.1,8121,8141.6,8212.9,8204.6,8270.7,8294.4,8373,8417.9,8458.4,8516.5,8521.2,8575.7,8622.5,8715.9,8680.6,8775.3,8867.9,8872.6,8923.6,8959.6,8987.7,9026.8,9100.1,9134.7,9168.1,9223.3,9254.1,9283.8,9360.4,9368.6,9393.9,9413.3,9431.2,9516.5,9553.1,9590.8,9631.6,9670.6,9708.9,9723.3,9759.6,9800.6,9837.5,9853.9,9928.6,9947.6,9963.2,9955.7,10004.2,10044.6,10093.3,10149.4,10151.1,10140.3,10083.2,9983.3,9851.2,9744.2,9792.1,9775.7,9742.9,9741.9,9759.7,9807.6,9835.2,9961.9,9875.4,9924.6,9946.1,10000.6,10003.4,10034.7,10095.5,10106.9,10140.2,10165.9,10184.3,10247.1,10268.9,10343.7,10399.8,10436.1,10474.7,10512.4,10583.5,10624.6,10653.1,10676.4,10727.1,10745.6,10790.6,10827.6,10828.7,10827.3,10905.5,10979.2,10994.3,11030.2,11029,11032.5,11074.8,11104.8,11179.6,11199.9,11222.8,11245.2,11303.2,11371.4,11378.8,11373.3,11407.1,11462.4,11484.7,11511.6,11559.6,11602.1,11671.5,11686.3,11663.9,11714.4,11807.1,11825.2,11864.3,11922.6,11944.4,12017,12044.6,12096.4,12142.2,12122,12080.8,12095.9,12161.5,12158.9],&#34;y&#34;:[12.5,12.5,11.7,12.5,12.5,12.1,11.7,12.2,11.6,12.2,12,11.6,10.6,10.4,10.4,10.6,10.4,10.9,10,9.4,9.9,9.5,10,10.9,11.7,11.5,11.5,11.3,11.5,11.7,11.7,11.6,12.3,13.3,12.3,11.7,13.2,13.1,12.9,13,13.3,12.9,13.1,13.1,13.3,13,13.4,14.4,13.6,13.6,12.9,13,12.8,12.9,12.4,12.6,11.5,11.3,11.5,11.4,11.4,11.8,12,12.7,13.4,13.4,12.1,12.2,12.4,12.8,12.8,13.2,12.8,13.6,12.8,14,14,14.4,14,13.8,13,12.7,12.3,12.5,12.7,11.6,12.3,13,13.4,13.6,12.8,12.1,12.3,13.9,17,13.9,12.3,12.6,12.6,13,12.3,11.5,11.3,11.9,11.8,11.2,11.8,10.9,11.2,11.2,10.8,10.6,10.9,9.9,9.8,8.5,9.8,9.9,9.8,10.2,10.1,10.5,10.7,10.7,10.8,11,11.4,10.7,10.5,10.3,9.8,9.5,10.3,9.9,10,10.2,10,10,10.6,10.5,10.7,10.4,9.8,9.3,10,9.2,8.9,9.3,9.4,9.8,9.6,9.8,9.8,10.5,10.6,10.4,10.5,10.6,11.1,11,11.5,11.2,10.5,10.4,10.3,10.3,10.4,10.2,11.7,11.4,11.9,12.5,12.7,12,12.2,11.6,11.7,12.4,11.7,11.6,12,11.9,11.1,10.7,10.3,10.3,10.4,10.5,10,9.6,9.4,8.5,9,8.7,9,9.1,9.7,9.5,9.4,11.1,10.9,10.9,10.5,10.5,11,11.2,11.2,11.2,10.3,10.6,9.7,8.5,8.1,9.4,10.5,9,8.5,7.5,6.7,8.5,8.4,8,8,8.7,9.3,9.1,8.6,8.8,8.7,8.4,6.6,7.8,8.2,6.4,9.1,7.9,7.9,3.8,7.5,7,6.8,6.5,7,7.6,7.9,8,7.5,7.9,7.5,8.1,7.7,7.8,7.9,7.8,8.2,8,7.7,7.7,8,8.4,8.9,7.9,7.6,7.6,7.7,7.1,7.5,7.9,8,7.2,7.4,8.1,7.8,8.2,8,7.9,8,7.5,7.5,7.3,7.4,8.2,8.7,8.3,7.4,8,7.7,8.2,7.6,7.9,8.1,8.6,8.4,9.1,8.8,9.2,9.2,9.4,9.4,9.5,9.1,9.2,8.2,7.4,7.3,9.9,8.3,8.4,8.3,8.2,7.7,7.2,7,7.1,6.3,5.6,5.6,8.4,6.4,5.9,6.2,5.8,7.1,6.3,6.4,5.9,6.2,6.5,6.4,6.5,6.9,7.3,7,6.3,6.5,6.1,6.4,6.1,6.1,6.5,6,5.5,6.1,6.1,6,5,6.1,6.5,6.1,5.9,6,5.8,5.8,5.7,5.6,5.7,5.8,5.9,6.2,6,5.5,5.4,5.6,5.6,5.8,5.8,6.7,6.8,6.9,6.6,6.3,6.2,6.3,6.2,5.8,5.6,5.7,5.2,5.7,5.6,5.3,4.5,4.3,4.2,4.1,4,3.5,3.9,4.1,3.7,4.7,4.2,3.9,4.4,4.2,4.2,4.6,4.6,3.8,4,3.8,3.5,4,4.1,4.5,4.3,3.7,3.7,5,6.1,6.3,2.7,3.4,3.8,5.6,5.3,5.3,5.1,5.6,5.4,4.6,4.4,4.9,4.7,4.7,4.5,4.5,4.7,4.6,4.6,5.1,4.9,5.5,5.3,4.5,4.6,4.7,4.8,4.5,4.5,4.5,4.7,4.7,5,4.5,4.6,3.9,3.8,3.4,6.3,2.9,2.7,2.7,2.1,3,2.2,1.9,2.4,2.3,2.6,2.7,2.8,3.7,3.8,3.7,3.4,3.2,3.4,2.9,3,3,3.1,3.2,3,3,3.3,3.6,3.2,3,2.8,2.8,2.6,2.8,2.8,2.5,3,3.4,3.9,4,3.5,7.9,5.6,4.4,3.7,4.4,5.4,6.3,6.5,6.5,5.9,6.1,6.7,8.1,6.7,6,4.9,5.9,5.4,5.7,5.7,5.6,5.2,5,5.6,6,5.9,5.9,5.8,5.6,5.4,5.3,5.9,6.2,6.4,6,5.9,5.9,6.1,6.3,6.2,5.7,5.5,5.6,6.4,6.6,6.7,6.9,7,7,7.1,6.6,6.4,6.5,7.1,8.2,10.5,4.5,4.7,4.9,5.1,5.2,5.3,5.1,5.3,5.2,4.7,4.3,4.1,4.9,5,4.8,5,5.1,5.1,5.1,4.7,4.6,4.6,4.5,5,5.5,5.7,5.2,5.6],&#34;z&#34;:[4.5,4.7,4.6,4.9,4.7,4.8,5.1,4.5,4.1,4.6,4.4,4.4,4.5,4.2,4.6,4.8,4.4,4.4,4.4,4.9,4,4,4.2,4.4,4.4,4.4,4.7,4.5,4.8,4.6,4.6,4.5,4.6,4.1,4.7,4.9,5.1,5.4,5.2,5.2,5.6,5.9,6.2,6.3,6.4,6.5,6.7,5.7,6.2,6.4,5.8,6.5,6.4,6.2,6.2,6.6,6.6,6.7,6.6,5.4,6.1,6,5.6,5.7,5.7,6.1,5.7,5.2,5.5,5,4.9,5,5.2,4.9,5.4,5.5,5.1,4.7,5,5.1,4.8,5,4.6,5.3,5.7,5,5.3,5.5,5.2,5.7,6.3,7.1,7.2,8.7,9.4,8.8,8.6,9.2,9.2,8.6,9.5,9,9,8.2,8.7,8.2,8.3,7.8,7.7,7.9,7.8,7.7,8.4,8,7.5,7.2,7.2,7.3,7.9,6.2,7.1,7,6.7,6.9,7,6.8,6.5,6.7,6.2,6.1,5.7,6,5.8,5.8,5.6,5.9,5.5,5.6,5.9,5.9,5.9,5.4,5.6,5.6,5.9,4.8,5.5,5.5,5.3,5.7,5.3,5.8,6,5.8,5.7,6.4,7,7.5,7.7,7.5,7.7,7.5,7.4,7.1,7.1,7.4,6.9,6.6,7.1,7.2,6.8,6.8,6.9,6.9,7.1,7.5,7.7,8.1,8.5,9.5,8.5,8.7,9.5,9.7,10,10.2,11.1,9.8,10.4,10.9,12.3,11.3,10.1,9.3,9.3,9.4,9.3,8.7,9.1,8.3,8.3,8.2,9.1,7.5,7.5,7.3,7.6,7.2,7.2,7.3,6.8,7.1,7.1,6.9,6.9,6.6,6.9,7.1,6.9,7.1,7,6.8,6.7,6.9,6.8,6.7,6.8,7,6.9,7.1,7.4,7,7.1,7.1,6.9,6.6,6.6,7.1,6.6,6.5,6.5,6.4,6,6.3,6.2,6,6.2,6.3,6.4,5.9,5.9,5.8,6.1,5.9,5.7,5.6,5.7,5.9,5.6,5.4,5.4,5.4,5.3,5.4,5.6,5,4.9,4.9,4.8,4.9,5.1,5.3,5.1,4.8,5.2,5.2,5.4,5.4,5.6,5.8,5.7,5.9,6,6.2,6.7,6.6,6.4,6.9,7,7.3,6.8,7.2,7.5,7.8,8.1,8.2,8.3,8.5,8.8,8.7,8.6,8.8,8.6,9,9,9.3,8.6,8.5,8.5,8.4,8.1,8.3,8.2,8.2,8.3,8,8.3,8.3,8.6,9.2,9.3,9.1,9.2,9.3,9,8.9,9.2,10,9,8.7,8,8.1,8.3,8.3,9.1,7.9,8.5,8.3,7.9,8.2,8,8.3,8.3,7.8,8.3,8.6,8.6,8.3,8.3,8.4,8.5,8.3,7.7,7.8,7.8,8.1,7.9,8.3,8,8,8.3,7.8,8.2,7.7,7.6,7.5,7.4,7,6.8,6.7,6,6.9,6.7,6.8,6.7,5.8,6.6,6.8,6.9,6.8,6.8,6.2,6.5,6.3,5.8,6.5,6,6.1,6.2,5.8,5.8,6.1,6,6.1,5.8,5.7,6,6.3,5.2,6.1,6.1,6,5.8,6.1,6.6,5.9,6.3,6,6.8,6.9,7.2,7.3,7.7,8.2,8.4,8.3,8.4,8.9,9.5,11,8.9,9,9.5,9.6,9.3,9.6,9.6,9.5,9.7,10.2,9.9,11.5,10.3,10.1,10.2,10.4,10.3,10.4,10.6,10.2,10.2,9.5,9.9,11,8.9,9.2,9.6,9.5,9.7,9.5,9.4,9.2,9.3,9,9.1,9,8.8,9.2,8.4,8.6,8.5,8.7,8.6,9.1,8.7,8.4,8.5,7.3,8,8.4,8,7.9,8.3,7.5,8.3,8.5,9.1,8.6,8.2,7.7,8.7,8.8,8.7,8.4,8.6,8.4,9,8.7,8.7,9.4,7.9,9,9.7,9.7,10.2,10.4,9.8,10.5,10.7,11.7,12.3,13.1,14.2,17.2,16,16.3,17.8,18.9,19.8,20.1,20,19.9,20.4,22.1,22.3,25.2,22.3,21,20.3,21.2,21,21.9,21.6,21.1,21.5,20.9,21.6,22.3,22,22.4,22,20.5,20.9,20.5,21,19.8,19.2,19.1,19.9,20.1,17.5,18.5,18.8,19.7,18.5,17.6,16.2,17.5,17.7,17.1,17,16.6,16.3,16.8,16.5,16.1,17,17,15.9,16.2,15.9,15.6,14.5,13.2,13.5,13.3,13.3,13.5,12.8,12.6,13.4,13.1,12.2,11.7],&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;true values&#34;,&#34;marker&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;size&#34;:[55],&#34;sizemode&#34;:&#34;area&#34;,&#34;line&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;}},&#34;textfont&#34;:{&#34;size&#34;:55},&#34;error_y&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;error_x&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;line&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;frame&#34;:null},{&#34;x&#34;:[564.22520579365,573.16581031746,600.090296818182,668.694908730159,573.16581031746,668.745963968254,720.629437467533,564.324630476191,580.827283333333,598.852676414142,583.717048693529,591.344222791652,598.257386904761,592.259389047619,595.354141334776,732.210983095238,593.094075728161,608.591176124987,602.826147950383,1139.14772650794,631.919058095239,777.100910000001,603.605438650793,608.591176124987,588.032153513153,600.900967055721,615.464970995671,639.032312539682,696.044797994228,600.090296818182,600.090296818182,605.666489682539,709.343493874459,652.190282380953,663.809447763348,661.626416673883,761.849128730159,783.425632222223,757.749168888889,768.213129365079,765.562750024419,786.318983227457,715.101218910535,750.449647460318,709.05378,754.448547380951,820.946921269841,826.559631223219,749.731188910535,738.054813333333,830.58932153846,754.448547380951,802.484532936507,740.737011767675,815.313938434344,829.65529690476,830.602783787878,998.799859365078,830.602783787878,901.811153650795,925.571644761905,862.614080714286,854.510562405372,901.462919794649,837.103874794649,792.457528571429,843.41685527084,827.537155555556,872.581052234432,863.510875483406,820.860403095238,822.214387943723,839.631369285715,851.875672222224,884.172603095239,876.565858742368,877.323524285714,779.795711666668,882.821173499279,876.614318730158,836.997935873015,886.377557229439,709.343493874459,901.367665079365,901.462919794649,802.463493181818,924.835845873014,856.412207472527,863.133371984128,860.601890270839,882.296622380953,1522.47854531746,1476.12575380952,1146.99630079365,1227.40883666667,1204.21281666667,1298.5886021645,1174.96351333333,1174.96351333333,1169.64801645022,1447.68330198413,1362.82312045455,1351.20125547619,1514.50816823953,1464.27942888889,1576.39672839105,1517.71542164931,1441.45028785714,1541.03834451659,1562.61232300866,1345.38114690476,1501.44354150793,1951.4907685348,1587.36792857143,1407.47445009768,2484.66978507936,1448.92200763736,1466.06403523809,1620.87269906593,1408.35659589466,1440.40178531746,1734.30806209846,1365.18475746032,1645.96318588745,1440.84879238095,1682.57167555089,1038.43438571429,1365.18475746032,1491.63338600289,1443.07951095238,1553.37054743201,1706.83488261905,1540.41794591076,1548.46101329171,1486.6635993895,1519.79475624333,1479.35352898046,1486.6635993895,1569.56557624333,1603.82697968489,1501.77455219571,1556.48005388889,1556.20721805861,1756.08702978632,1535.6474126719,1887.87623023809,2316.51045636141,1743.64352747253,1696.40091142857,1553.37054743201,1669.19735952381,1635.98898751637,1605.861982558,1653.50041173327,1571.49528177878,1581.68747071429,1734.30806209846,1983.08250555555,1675.64895730158,2070.98967769841,1730.14889291486,2134.09285173882,2065.37477852702,1846.97007174603,1894.83426579365,2052.37516261905,2009.10860593074,1653.18746880952,1876.94213808802,1930.91009690476,1823.19727269374,1743.06362396359,1731.59320517316,1887.63157898268,1600.87394293651,1987.6977934127,1817.13517165945,1705.37007333333,1839.5249641342,1847.37742603174,1816.86609738095,1594.59193126984,2101.69182373016,2233.73613309523,2241.30178333333,2312.96572333333,2411.35435880952,2363.6239686125,2436.25806333333,2560.34694,4134.30054904762,2862.17949103175,2460.20725333333,2677.82100070707,2543.7600240404,2599.88999785714,2735.31834880231,3251.60077269841,2832.80166595239,2121.26511672868,2134.34431164932,1982.63911681097,2356.88413583472,2109.74322693972,2070.98967769841,2338.24937713564,2238.40748586581,2227.68797570707,2162.16937357143,2223.01966428571,2279.74040126518,2572.1821684127,3024.94694722222,2663.32099354978,2069.69110699745,2686.56321547619,2615.14271696248,3070.71720365689,4306.61993223666,2572.1821684127,3110.21582857143,3203.68553934321,3144.45505014153,2936.87404997835,2710.12988912231,2833.83145007936,2989.75392428104,2948.174265,2936.87404997835,3006.12906626985,4418.10603007937,3298.63511428571,3129.08495131258,4263.39098920636,2875.36367926407,3210.50643296007,3210.50643296007,5091.80216825398,3243.29072445055,3497.91411071428,3863.5102865873,4139.40101862194,3595.78473190475,3282.6467236508,3253.41028213757,3327.28233942724,3265.43865471029,3249.7678967191,3360.27604754579,3450.21056719571,3433.81007697926,3398.80825701466,3255.57779973497,3369.87676783063,3610.9635540651,3508.40934379232,3510.47623753607,3433.81007697926,3508.40934379232,3467.32570777777,2741.73437968254,3625.82353430207,3615.45368928571,3617.32331944444,3553.51590660894,3796.5232891342,3596.75229011599,3594.17459079779,3458.5358721978,3660.58181388888,3690.89930761904,3666.78555603175,3618.73324619047,3492.53638662282,3713.50399466533,3704.08449985762,3648.89143530025,3713.7557131807,3685.73718286324,3769.18510939561,3789.21197148268,3654.47504493686,3220.51107928572,3697.74822279943,3712.56198269841,3374.68285942723,3538.33761152958,3593.40806251749,3510.39186023809,4046.55287648599,3512.10080190009,3108.56367166666,3799.05090595238,3913.4765247619,3925.73824999999,4050.81470323954,4110.31048707273,3716.15813952381,3700.66357928572,3251.60077269841,3951.22694295815,4054.98676880953,4406.51933855644,4421.51208119048,4447.63103404762,3052.27478118327,4359.95457343434,4314.74740642857,4389.16709690476,4509.31250179542,4858.89726,4601.60531151038,4697.03778491342,4741.96997158008,5038.01352961704,5358.18550334582,5329.32103458964,4391.13175834256,4851.29645824509,4959.52269114163,4923.79387906482,5139.41781184704,4692.10966904761,5166.34438932179,4853.77878412699,5108.43966542735,4896.2918507387,6840.82298290764,4853.77878412699,5210.76562489177,5131.13879779941,4665.14061666666,4759.73320759391,5038.01352961704,5025.00372600288,5273.41506323787,4933.14056880953,5172.76337040521,5273.41506323787,5003.39986996392,5306.52690357143,5488.26567399995,5172.76337040521,5232.3292804601,5259.46901039966,6679.0058455972,5219.11643838772,5039.80446000571,5172.76337040521,5573.28935987845,5326.96248156565,5325.493153062,5551.24043184704,5487.39564456155,5512.58482253052,5447.1810977578,5488.53953002165,5319.6386848169,5260.84594615718,5306.52690357143,5488.26567399995,5957.98453230159,5467.7914195807,5670.50812903846,5682.66188422799,5724.78892327561,4749.34827920635,4766.44365492063,5033.34233428104,5061.49450103174,5796.63290877344,6129.44802716727,6026.86924663059,5995.23050882927,5990.2987003391,5965.75073867216,6006.4501860695,6331.52498269376,6164.09356249806,6044.5413835576,6338.14844769376,6461.66326666668,6399.83753999999,6499.40573690476,6628.57997558609,6423.53939555555,6871.82545922799,6693.64128082363,6468.73386952382,6769.74683098292,6648.84952772895,6729.13527796648,6717.97931525974,6800.69277010934,6634.14597201466,6472.78077760102,6766.03737452382,6670.71799571429,6392.17885523811,6841.17225471251,6694.97663939505,6871.82545922799,6773.67822447497,6784.60947915695,6699.65559619048,6801.04282050063,6893.90436928572,6894.15012851371,6667.48882277313,6353.42636236486,6200.63541996392,8084.07862714287,8217.76379095238,7344.27528126985,6686.88961535105,6671.18907061264,7047.90493075703,7537.40839285715,7865.7516317735,8212.81763976192,7756.68810376068,8339.17073809524,7604.54218142858,7677.37229502886,7703.49889279941,7721.61211183538,7721.61211183538,7735.1408433622,7838.02330233211,7891.54874780831,7780.33607190476,8312.24462809522,8104.31838650793,7820.60867436507,8008.06423199411,8054.96567757021,7943.68000852092,8113.22812201298,8171.7287522322,8008.06423199411,8008.06423199411,7735.1408433622,7905.68787518758,7981.68160825398,7857.6194599667,7949.97924899876,8724.76942333332,8678.63483071427,9168.93132214285,7393.30368718614,8829.18947333334,8643.11214476191,8590.13144134199,8836.48881,8926.51014611112,8836.73580999999,9096.0773079365,8722.62972714286,9070.58958432845,9249.91740385115,9093.65762499999,9536.12277628426,9044.76666527973,8997.07643976191,9371.33064533189,9271.28620980463,9361.76891238096,7973.34123785714,9255.09007285714,9510.46428270452,9279.87969147131,9193.31411051892,9210.08749238639,8899.12559385225,9262.79217131801,9375.07039238095,9360.76593642858,9389.55716551782,9272.77072369353,9027.44939047618,9536.12277628426,9399.67928682539,9536.12277628426,9531.00728480463,9409.29998170829,9510.46428270452,9312.09391119049,9589.32993779222,9640.60049001445,9268.94105714286,6638.97785704875,7997.12514173686,9250.61495531748,9451.813765,9389.76473555558,8605.43019690475,8198.85242226552,8824.20250539684,8864.2711670635,9984.20050874294,9750.76929068376,10038.1644606349,9004.20460142858,10173.6459839683,10101.0282883334,10937.7617185714,10129.7172852509,10210.50257,10166.6558467765,10142.8501334432,10153.6401309812,10359.4321995238,10440.8750151587,10400.1998943146,10285.0218352381,10247.2946150128,10261.4217433461,10317.4097341919,10254.6362143146,10344.03456,10455.2285600794,10435.0505533461,10547.1506852625,10617.7924509524,10440.8600685714,10492.7318866794,10459.2183866794,10462.3700206838,10612.4053533333,10560.3322385958,10551.2164943956,10578.3331465079,10542.9375176479,10739.602327619,10759.5798566667,10725.890065873,10868.0800666667,10839.9623752381,10803.8436019048,10784.1816238095,10694.82378,10874.912497619,10856.091348254,10831.3530304762,10309.2547200794,8889.12448615388,11473.5259619048,11383.7557443651,11069.2265652381,11442.0809864286,11428.8549128571,11311.1300376984,11322.7120930952,11319.2593743651,11431.9258861905,11513.2523143651,11550.6707519048,11505.8726452381,11474.3144585714,11431.8695818254,11649.21456,11689.3625651587,11844.5115600794,11907.9919534127,11916.0265034127,11910.4956738889,11951.8182420147,11957.135255348,11891.7293219048,11814.7023351587,11653.6489165079,11337.8887410623,11497.3139928572,10931.3276819336],&#34;y&#34;:[12.5,12.5,11.7,12.5,12.5,12.1,11.7,12.2,11.6,12.2,12,11.6,10.6,10.4,10.4,10.6,10.4,10.9,10,9.4,9.9,9.5,10,10.9,11.7,11.5,11.5,11.3,11.5,11.7,11.7,11.6,12.3,13.3,12.3,11.7,13.2,13.1,12.9,13,13.3,12.9,13.1,13.1,13.3,13,13.4,14.4,13.6,13.6,12.9,13,12.8,12.9,12.4,12.6,11.5,11.3,11.5,11.4,11.4,11.8,12,12.7,13.4,13.4,12.1,12.2,12.4,12.8,12.8,13.2,12.8,13.6,12.8,14,14,14.4,14,13.8,13,12.7,12.3,12.5,12.7,11.6,12.3,13,13.4,13.6,12.8,12.1,12.3,13.9,17,13.9,12.3,12.6,12.6,13,12.3,11.5,11.3,11.9,11.8,11.2,11.8,10.9,11.2,11.2,10.8,10.6,10.9,9.9,9.8,8.5,9.8,9.9,9.8,10.2,10.1,10.5,10.7,10.7,10.8,11,11.4,10.7,10.5,10.3,9.8,9.5,10.3,9.9,10,10.2,10,10,10.6,10.5,10.7,10.4,9.8,9.3,10,9.2,8.9,9.3,9.4,9.8,9.6,9.8,9.8,10.5,10.6,10.4,10.5,10.6,11.1,11,11.5,11.2,10.5,10.4,10.3,10.3,10.4,10.2,11.7,11.4,11.9,12.5,12.7,12,12.2,11.6,11.7,12.4,11.7,11.6,12,11.9,11.1,10.7,10.3,10.3,10.4,10.5,10,9.6,9.4,8.5,9,8.7,9,9.1,9.7,9.5,9.4,11.1,10.9,10.9,10.5,10.5,11,11.2,11.2,11.2,10.3,10.6,9.7,8.5,8.1,9.4,10.5,9,8.5,7.5,6.7,8.5,8.4,8,8,8.7,9.3,9.1,8.6,8.8,8.7,8.4,6.6,7.8,8.2,6.4,9.1,7.9,7.9,3.8,7.5,7,6.8,6.5,7,7.6,7.9,8,7.5,7.9,7.5,8.1,7.7,7.8,7.9,7.8,8.2,8,7.7,7.7,8,8.4,8.9,7.9,7.6,7.6,7.7,7.1,7.5,7.9,8,7.2,7.4,8.1,7.8,8.2,8,7.9,8,7.5,7.5,7.3,7.4,8.2,8.7,8.3,7.4,8,7.7,8.2,7.6,7.9,8.1,8.6,8.4,9.1,8.8,9.2,9.2,9.4,9.4,9.5,9.1,9.2,8.2,7.4,7.3,9.9,8.3,8.4,8.3,8.2,7.7,7.2,7,7.1,6.3,5.6,5.6,8.4,6.4,5.9,6.2,5.8,7.1,6.3,6.4,5.9,6.2,6.5,6.4,6.5,6.9,7.3,7,6.3,6.5,6.1,6.4,6.1,6.1,6.5,6,5.5,6.1,6.1,6,5,6.1,6.5,6.1,5.9,6,5.8,5.8,5.7,5.6,5.7,5.8,5.9,6.2,6,5.5,5.4,5.6,5.6,5.8,5.8,6.7,6.8,6.9,6.6,6.3,6.2,6.3,6.2,5.8,5.6,5.7,5.2,5.7,5.6,5.3,4.5,4.3,4.2,4.1,4,3.5,3.9,4.1,3.7,4.7,4.2,3.9,4.4,4.2,4.2,4.6,4.6,3.8,4,3.8,3.5,4,4.1,4.5,4.3,3.7,3.7,5,6.1,6.3,2.7,3.4,3.8,5.6,5.3,5.3,5.1,5.6,5.4,4.6,4.4,4.9,4.7,4.7,4.5,4.5,4.7,4.6,4.6,5.1,4.9,5.5,5.3,4.5,4.6,4.7,4.8,4.5,4.5,4.5,4.7,4.7,5,4.5,4.6,3.9,3.8,3.4,6.3,2.9,2.7,2.7,2.1,3,2.2,1.9,2.4,2.3,2.6,2.7,2.8,3.7,3.8,3.7,3.4,3.2,3.4,2.9,3,3,3.1,3.2,3,3,3.3,3.6,3.2,3,2.8,2.8,2.6,2.8,2.8,2.5,3,3.4,3.9,4,3.5,7.9,5.6,4.4,3.7,4.4,5.4,6.3,6.5,6.5,5.9,6.1,6.7,8.1,6.7,6,4.9,5.9,5.4,5.7,5.7,5.6,5.2,5,5.6,6,5.9,5.9,5.8,5.6,5.4,5.3,5.9,6.2,6.4,6,5.9,5.9,6.1,6.3,6.2,5.7,5.5,5.6,6.4,6.6,6.7,6.9,7,7,7.1,6.6,6.4,6.5,7.1,8.2,10.5,4.5,4.7,4.9,5.1,5.2,5.3,5.1,5.3,5.2,4.7,4.3,4.1,4.9,5,4.8,5,5.1,5.1,5.1,4.7,4.6,4.6,4.5,5,5.5,5.7,5.2,5.6],&#34;z&#34;:[4.5,4.7,4.6,4.9,4.7,4.8,5.1,4.5,4.1,4.6,4.4,4.4,4.5,4.2,4.6,4.8,4.4,4.4,4.4,4.9,4,4,4.2,4.4,4.4,4.4,4.7,4.5,4.8,4.6,4.6,4.5,4.6,4.1,4.7,4.9,5.1,5.4,5.2,5.2,5.6,5.9,6.2,6.3,6.4,6.5,6.7,5.7,6.2,6.4,5.8,6.5,6.4,6.2,6.2,6.6,6.6,6.7,6.6,5.4,6.1,6,5.6,5.7,5.7,6.1,5.7,5.2,5.5,5,4.9,5,5.2,4.9,5.4,5.5,5.1,4.7,5,5.1,4.8,5,4.6,5.3,5.7,5,5.3,5.5,5.2,5.7,6.3,7.1,7.2,8.7,9.4,8.8,8.6,9.2,9.2,8.6,9.5,9,9,8.2,8.7,8.2,8.3,7.8,7.7,7.9,7.8,7.7,8.4,8,7.5,7.2,7.2,7.3,7.9,6.2,7.1,7,6.7,6.9,7,6.8,6.5,6.7,6.2,6.1,5.7,6,5.8,5.8,5.6,5.9,5.5,5.6,5.9,5.9,5.9,5.4,5.6,5.6,5.9,4.8,5.5,5.5,5.3,5.7,5.3,5.8,6,5.8,5.7,6.4,7,7.5,7.7,7.5,7.7,7.5,7.4,7.1,7.1,7.4,6.9,6.6,7.1,7.2,6.8,6.8,6.9,6.9,7.1,7.5,7.7,8.1,8.5,9.5,8.5,8.7,9.5,9.7,10,10.2,11.1,9.8,10.4,10.9,12.3,11.3,10.1,9.3,9.3,9.4,9.3,8.7,9.1,8.3,8.3,8.2,9.1,7.5,7.5,7.3,7.6,7.2,7.2,7.3,6.8,7.1,7.1,6.9,6.9,6.6,6.9,7.1,6.9,7.1,7,6.8,6.7,6.9,6.8,6.7,6.8,7,6.9,7.1,7.4,7,7.1,7.1,6.9,6.6,6.6,7.1,6.6,6.5,6.5,6.4,6,6.3,6.2,6,6.2,6.3,6.4,5.9,5.9,5.8,6.1,5.9,5.7,5.6,5.7,5.9,5.6,5.4,5.4,5.4,5.3,5.4,5.6,5,4.9,4.9,4.8,4.9,5.1,5.3,5.1,4.8,5.2,5.2,5.4,5.4,5.6,5.8,5.7,5.9,6,6.2,6.7,6.6,6.4,6.9,7,7.3,6.8,7.2,7.5,7.8,8.1,8.2,8.3,8.5,8.8,8.7,8.6,8.8,8.6,9,9,9.3,8.6,8.5,8.5,8.4,8.1,8.3,8.2,8.2,8.3,8,8.3,8.3,8.6,9.2,9.3,9.1,9.2,9.3,9,8.9,9.2,10,9,8.7,8,8.1,8.3,8.3,9.1,7.9,8.5,8.3,7.9,8.2,8,8.3,8.3,7.8,8.3,8.6,8.6,8.3,8.3,8.4,8.5,8.3,7.7,7.8,7.8,8.1,7.9,8.3,8,8,8.3,7.8,8.2,7.7,7.6,7.5,7.4,7,6.8,6.7,6,6.9,6.7,6.8,6.7,5.8,6.6,6.8,6.9,6.8,6.8,6.2,6.5,6.3,5.8,6.5,6,6.1,6.2,5.8,5.8,6.1,6,6.1,5.8,5.7,6,6.3,5.2,6.1,6.1,6,5.8,6.1,6.6,5.9,6.3,6,6.8,6.9,7.2,7.3,7.7,8.2,8.4,8.3,8.4,8.9,9.5,11,8.9,9,9.5,9.6,9.3,9.6,9.6,9.5,9.7,10.2,9.9,11.5,10.3,10.1,10.2,10.4,10.3,10.4,10.6,10.2,10.2,9.5,9.9,11,8.9,9.2,9.6,9.5,9.7,9.5,9.4,9.2,9.3,9,9.1,9,8.8,9.2,8.4,8.6,8.5,8.7,8.6,9.1,8.7,8.4,8.5,7.3,8,8.4,8,7.9,8.3,7.5,8.3,8.5,9.1,8.6,8.2,7.7,8.7,8.8,8.7,8.4,8.6,8.4,9,8.7,8.7,9.4,7.9,9,9.7,9.7,10.2,10.4,9.8,10.5,10.7,11.7,12.3,13.1,14.2,17.2,16,16.3,17.8,18.9,19.8,20.1,20,19.9,20.4,22.1,22.3,25.2,22.3,21,20.3,21.2,21,21.9,21.6,21.1,21.5,20.9,21.6,22.3,22,22.4,22,20.5,20.9,20.5,21,19.8,19.2,19.1,19.9,20.1,17.5,18.5,18.8,19.7,18.5,17.6,16.2,17.5,17.7,17.1,17,16.6,16.3,16.8,16.5,16.1,17,17,15.9,16.2,15.9,15.6,14.5,13.2,13.5,13.3,13.3,13.5,12.8,12.6,13.4,13.1,12.2,11.7],&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;modelled values&#34;,&#34;marker&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;size&#34;:[55],&#34;sizemode&#34;:&#34;area&#34;,&#34;line&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;}},&#34;textfont&#34;:{&#34;size&#34;:55},&#34;error_y&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;error_x&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;line&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;frame&#34;:null}],&#34;highlight&#34;:{&#34;on&#34;:&#34;plotly_click&#34;,&#34;persistent&#34;:false,&#34;dynamic&#34;:false,&#34;selectize&#34;:false,&#34;opacityDim&#34;:0.2,&#34;selected&#34;:{&#34;opacity&#34;:1},&#34;debounce&#34;:0},&#34;base_url&#34;:&#34;https://plot.ly&#34;},&#34;evals&#34;:[&#34;config.modeBarButtonsToAdd.0.click&#34;],&#34;jsHooks&#34;:[]}&lt;/script&gt;
Look’s like random forrest models are pretty decent for non-linear regression!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>re-writing as.formula</title>
      <link>/2019/01/30/re-writing-as-formula/</link>
      <pubDate>Wed, 30 Jan 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/01/30/re-writing-as-formula/</guid>
      <description>


&lt;p&gt;The base r function as.formula uses R’s parsing rules, so it ignores white space, but cares about operators. That can lead to problems if the string it’s passed doesn’t obey those rules. For instance&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as.formula(&amp;quot;money ~ brains + looks&amp;quot;) # works&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## money ~ brains + looks&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;works fine, but&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as.formula(&amp;quot;gross-pay ~ min-wage + tips&amp;quot;) # doesn&amp;#39;t work&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## gross - pay ~ min - wage + tips&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;doesn’t work, because it confuses hyphens with minus signs.&lt;/p&gt;
&lt;p&gt;Let’s pause a minute and think of when we might want to use as.formula. A typical example might be when you want to experiment with different formulae on one dataset. e.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(purrr)
library(broom)
library(dplyr, warn.conflicts = FALSE)

mtcars %&amp;gt;% names %&amp;gt;%                   # get the names
      setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # take of mpg because that&amp;#39;s what we&amp;#39;ll model
      combn(3, simplify = FALSE) %&amp;gt;%   # get all combinations of 3 columns
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # make the rhs of the formula
      map_chr(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # add the lhs
      tibble(formula = .,                            
             model = formula %&amp;gt;% map(~lm(as.formula(.), data = mtcars)), # build models
             r_squared = model %&amp;gt;% map_dbl(. %&amp;gt;% glance %&amp;gt;% .$r.squared) # extract r.squred
            ) %&amp;gt;%
      arrange(desc(r_squared))  # find the best formulae&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 120 x 3
##    formula                 model    r_squared
##    &amp;lt;chr&amp;gt;                   &amp;lt;list&amp;gt;       &amp;lt;dbl&amp;gt;
##  1 mpg ~  wt + qsec + am   &amp;lt;S3: lm&amp;gt;     0.850
##  2 mpg ~  cyl + hp + wt    &amp;lt;S3: lm&amp;gt;     0.843
##  3 mpg ~  cyl + wt + carb  &amp;lt;S3: lm&amp;gt;     0.842
##  4 mpg ~  hp + wt + am     &amp;lt;S3: lm&amp;gt;     0.840
##  5 mpg ~  cyl + wt + qsec  &amp;lt;S3: lm&amp;gt;     0.840
##  6 mpg ~  drat + wt + qsec &amp;lt;S3: lm&amp;gt;     0.837
##  7 mpg ~  hp + drat + wt   &amp;lt;S3: lm&amp;gt;     0.837
##  8 mpg ~  hp + wt + gear   &amp;lt;S3: lm&amp;gt;     0.835
##  9 mpg ~  hp + wt + qsec   &amp;lt;S3: lm&amp;gt;     0.835
## 10 mpg ~  wt + qsec + gear &amp;lt;S3: lm&amp;gt;     0.833
## # … with 110 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;this is all well and good but imagine if the column names of mtcars were not so neat and tidy.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)
mtcars1 &amp;lt;- mtcars %&amp;gt;% rename(`q-sec` = qsec) 

mtcars1 %&amp;gt;% names %&amp;gt;% # mess up a name
  setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # same
      combn(3, simplify = FALSE) %&amp;gt;%   # code 
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # as
      map(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # before
      unlist %&amp;gt;%
      tibble(formula = ., 
             model = formula %&amp;gt;% map(~lm(as.formula(.), data = mtcars1)) 
            )&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in eval(predvars, data, env): object &amp;#39;sec&amp;#39; not found&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, let’s re-write as.formula&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(stringr)
library(rlang, warn.conflicts = FALSE)

as_formula &amp;lt;- function(string) {
  
  parts &amp;lt;- string %&amp;gt;% str_extract_all(&amp;quot;[A-Za-z\\-\\\\]+&amp;quot;) %&amp;gt;% .[[1]] %&amp;gt;% syms 
  target &amp;lt;- parts[[1]]
  inputs &amp;lt;- parts[-1]
  rhs &amp;lt;- inputs %&amp;gt;% reduce(~expr(!!.x + !!.y))
  expr(!!target ~ !!rhs)
  
    }

as_formula(&amp;quot;gross-pay ~ min-wage + tips&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `gross-pay` ~ `min-wage` + tips&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s just try it out on our previous example:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mtcars1 %&amp;gt;% names %&amp;gt;%                   # get the names
      setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # take of mpg because that&amp;#39;s what we&amp;#39;ll model
      combn(3, simplify = FALSE) %&amp;gt;%   # get all combinations of 3 columns
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # make the rhs of the formula
      map_chr(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # add the lhs
      tibble(formula = .,                            
             model = formula %&amp;gt;% map(~lm(as_formula(.), data = mtcars1)), # build models
             r_squared = model %&amp;gt;% map_dbl(. %&amp;gt;% glance %&amp;gt;% .$r.squared) # extract r.squred
            ) %&amp;gt;%
      arrange(desc(r_squared))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 120 x 3
##    formula                  model    r_squared
##    &amp;lt;chr&amp;gt;                    &amp;lt;list&amp;gt;       &amp;lt;dbl&amp;gt;
##  1 mpg ~  wt + q-sec + am   &amp;lt;S3: lm&amp;gt;     0.850
##  2 mpg ~  cyl + hp + wt     &amp;lt;S3: lm&amp;gt;     0.843
##  3 mpg ~  cyl + wt + carb   &amp;lt;S3: lm&amp;gt;     0.842
##  4 mpg ~  hp + wt + am      &amp;lt;S3: lm&amp;gt;     0.840
##  5 mpg ~  cyl + wt + q-sec  &amp;lt;S3: lm&amp;gt;     0.840
##  6 mpg ~  drat + wt + q-sec &amp;lt;S3: lm&amp;gt;     0.837
##  7 mpg ~  hp + drat + wt    &amp;lt;S3: lm&amp;gt;     0.837
##  8 mpg ~  hp + wt + gear    &amp;lt;S3: lm&amp;gt;     0.835
##  9 mpg ~  hp + wt + q-sec   &amp;lt;S3: lm&amp;gt;     0.835
## 10 mpg ~  wt + q-sec + gear &amp;lt;S3: lm&amp;gt;     0.833
## # … with 110 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, I admit it. This version of as.formula isn’t actually better than the original at all, because it can’t handle interaction terms, since it assumes you wants ’+’s on the rhs of your formula.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as_formula(&amp;quot;bedtime ~ tiredness * coding&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## bedtime ~ tiredness + coding&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clearly isn’t correct. Nonetheless, it might be useful in the case when you have complex names and a simple linear model. Maybe it should be called as_linear_formula..&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About</title>
      <link>/about/</link>
      <pubDate>Sun, 27 Jan 2019 21:48:51 -0700</pubDate>
      
      <guid>/about/</guid>
      <description>&lt;p&gt;This is the person programming blog of Tom Greenwood (who after this introductory paragraph will henceforth refer to himself in the first person). Most probably, these posts will read as a series of attempts to run before learning to walk.&lt;/p&gt;

&lt;p&gt;It is built using the &lt;a href=&#34;https://github.com/rstudio/blogdown&#34;&gt;&lt;strong&gt;blogdown&lt;/strong&gt;&lt;/a&gt; package. The theme was forked from &lt;a href=&#34;https://github.com/jrutheiser/hugo-lithium-theme&#34;&gt;@jrutheiser/hugo-lithium-theme&lt;/a&gt; and modified by &lt;a href=&#34;https://github.com/yihui/hugo-lithium&#34;&gt;Yihui Xie&lt;/a&gt; and then actually modified a little bit more, by me.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>fun with map ( expr ) %&gt;% reduce </title>
      <link>/2019/01/27/metaprogramming-with-map-quo-reduce/</link>
      <pubDate>Sun, 27 Jan 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/01/27/metaprogramming-with-map-quo-reduce/</guid>
      <description>


&lt;p&gt;Ever since I discovered the rlang function ‘expr’ I have become mildy obsessed with the idea of writing code which writes code. This will be the first of probably many posts where I experiment with combining either iteration or recursion with non-standard evaluation. However, before launching into anything genuinely useful, some background is required:&lt;/p&gt;
&lt;p&gt;R is an ‘eagerly evaluated’ language, which means if you write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a &amp;lt;- 50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then just write a and hit enter you get:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This becomes problematic when you want one variable, let’s called it a, to hold the name of
another variable, b. If you write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a &amp;lt;- b&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in eval(expr, envir, enclos): object &amp;#39;b&amp;#39; not found&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You get an error, because r is eagerly trying to evaluate b, so that it can pass b’s value to a. That’s not r’s fault, that’s just the way it was built.&lt;/p&gt;
&lt;p&gt;Base r does have functions for preventing this, but I’m not even going to talk about those, since the functions from the rlang package are just better, so let’s talk about those instead. with rlang you can write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rlang)
a &amp;lt;- expr(b)
a&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## b&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is nice. We haven’t even defined b yet, but we’re now allowed to tell r that a is b.
rlang also has a function for telling r to go get rid of the ‘expr’ and look underneath to find out what’s in b. The function is eval_tidy(). Let’s assign a value to b first, so that we won’t get an error.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;b &amp;lt;- &amp;quot;hey here&amp;quot;
eval_tidy(a)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;hey here&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Additionally, rlang provides a function for ‘unquoting’ i.e. which is essentially like evaluating but only one step down. To demonstrate this, let’s build a slightly bigger expression:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;c &amp;lt;- expr(d)
d &amp;lt;- &amp;quot; Tom&amp;quot;
e &amp;lt;- expr(paste(!!a, !!c, sep = &amp;quot;,&amp;quot;))
e&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## paste(b, d, sep = &amp;quot;,&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;eval_tidy(e)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;hey here, Tom&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, so you get the idea. We can build bigger expressions by unquoting smaller ones inside them. This is where things start to get interesting. One of the things I really hate writing is nested ifelse statements. It’s easy to make a typo and it just feels repetitive. Using map, expr and reduce we can write this function, which will write them for us.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# we&amp;#39;ll need the purrr package, for it&amp;#39;s map and reduce functions and if_else from dplyr
library(dplyr, warn.conflicts = FALSE)
library(purrr, warn.conflicts = FALSE)

build_ifelse &amp;lt;- function(mapping_list, col) { 
     
                  col &amp;lt;- enexpr(col)
                     
                  mapping_list %&amp;gt;% map(~ list(expr(!!col %in% !!.[[2]]), .[[1]] ) ) %&amp;gt;%
                { c(&amp;quot;other&amp;quot;, .) } %&amp;gt;%
                  reduce(~ expr(if_else(!!(.y[[1]]), !!(.y[[2]]), !!.x )))           
     
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If we define a mapping that we want to build our if_else statement upon (I always use if_else, rather than ifelse, not becaues it’s faster, but because you know what type you’ll get out)&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# define a mapping 
i = 1
numbers &amp;lt;- list()
pot &amp;lt;- seq(from = 1, to = (26*3), by = 1)
while (i &amp;lt;= 26) {
        numbers[[i]] &amp;lt;- sample(pot, 3)
        pot &amp;lt;- setdiff(pot, numbers %&amp;gt;% unlist)
        i &amp;lt;- i + 1
        }


mapping &amp;lt;- list(letters, numbers) %&amp;gt;%
                    transpose

# use the fuction to build the if_else statement
mapping_exp &amp;lt;- build_ifelse(mapping, number)

# have a look at it
mapping_exp&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## if_else(number %in% c(32, 30, 56), &amp;quot;z&amp;quot;, if_else(number %in% c(42, 
## 61, 51), &amp;quot;y&amp;quot;, if_else(number %in% c(12, 19, 27), &amp;quot;x&amp;quot;, if_else(number %in% 
##     c(43, 33, 31), &amp;quot;w&amp;quot;, if_else(number %in% c(36, 49, 57), &amp;quot;v&amp;quot;, 
##     if_else(number %in% c(69, 60, 5), &amp;quot;u&amp;quot;, if_else(number %in% 
##         c(41, 21, 26), &amp;quot;t&amp;quot;, if_else(number %in% c(72, 63, 6), 
##         &amp;quot;s&amp;quot;, if_else(number %in% c(77, 8, 46), &amp;quot;r&amp;quot;, if_else(number %in% 
##             c(39, 47, 54), &amp;quot;q&amp;quot;, if_else(number %in% c(14, 38, 
##         48), &amp;quot;p&amp;quot;, if_else(number %in% c(58, 76, 16), &amp;quot;o&amp;quot;, if_else(number %in% 
##             c(9, 23, 45), &amp;quot;n&amp;quot;, if_else(number %in% c(52, 62, 
##         68), &amp;quot;m&amp;quot;, if_else(number %in% c(78, 74, 18), &amp;quot;l&amp;quot;, if_else(number %in% 
##             c(28, 2, 3), &amp;quot;k&amp;quot;, if_else(number %in% c(10, 1, 64
##         ), &amp;quot;j&amp;quot;, if_else(number %in% c(66, 17, 71), &amp;quot;i&amp;quot;, if_else(number %in% 
##             c(20, 35, 50), &amp;quot;h&amp;quot;, if_else(number %in% c(4, 24, 
##         37), &amp;quot;g&amp;quot;, if_else(number %in% c(40, 73, 7), &amp;quot;f&amp;quot;, if_else(number %in% 
##             c(75, 34, 44), &amp;quot;e&amp;quot;, if_else(number %in% c(29, 53, 
##         25), &amp;quot;d&amp;quot;, if_else(number %in% c(55, 59, 67), &amp;quot;c&amp;quot;, if_else(number %in% 
##             c(11, 22, 70), &amp;quot;b&amp;quot;, if_else(number %in% c(65, 15, 
##         13), &amp;quot;a&amp;quot;, &amp;quot;other&amp;quot;))))))))))))))))))))))))))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think it’s fair to say that’s a bit of code you wouldn’t really want to write manually!&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# make a tbl with only numbers to test it on
number_tbl &amp;lt;- tibble(number = sample(1:120, 10))

# use the expression to find the right letter for each number
number_tbl %&amp;gt;% mutate(letter = !!mapping_exp)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    number letter
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt; 
##  1     30 z     
##  2     56 z     
##  3     70 b     
##  4     84 other 
##  5     68 m     
##  6     10 j     
##  7     52 m     
##  8     48 p     
##  9     79 other 
## 10     28 k&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Some provisos here: 1) Really you should use quo, not expr inside functions, because quo tracks its environment, and the fact that expr doesn’t can get you into a lot of trouble. So, the function should really be written:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;build_ifelse1 &amp;lt;- function(mapping_list, col) { 
     
                  col &amp;lt;- enquo(col)
                     
                  mapping_list %&amp;gt;% map(~ list(quo(!!col %in% !!.[[2]]), .[[1]] ) ) %&amp;gt;%
                { c(&amp;quot;other&amp;quot;, .) } %&amp;gt;%
                  reduce(~ quo(if_else(!!(.y[[1]]), !!(.y[[2]]), !!.x )))           
     
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The reasons I didn’t do it that way, for the purposes of this article is because the expression, when using quo is harder to read.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# use the fuction to build the if_else statement
mapping_exp1 &amp;lt;- build_ifelse1(mapping, number)

# have a look at it
mapping_exp1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## &amp;lt;quosure&amp;gt;
## expr: ^if_else(^(^number) %in% &amp;lt;dbl: 32, 30, 56&amp;gt;, &amp;quot;z&amp;quot;, ^if_else(^(^number)
##            %in% &amp;lt;dbl: 42, 61, 51&amp;gt;, &amp;quot;y&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 12, 19, 27&amp;gt;, &amp;quot;x&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 43, 33, 31&amp;gt;, &amp;quot;w&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 36, 49, 57&amp;gt;, &amp;quot;v&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 69, 60, 5&amp;gt;, &amp;quot;u&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 41, 21, 26&amp;gt;, &amp;quot;t&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 72, 63, 6&amp;gt;, &amp;quot;s&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 77, 8, 46&amp;gt;, &amp;quot;r&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 39, 47, 54&amp;gt;, &amp;quot;q&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 14, 38, 48&amp;gt;, &amp;quot;p&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 58, 76, 16&amp;gt;, &amp;quot;o&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 9, 23, 45&amp;gt;, &amp;quot;n&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 52, 62, 68&amp;gt;, &amp;quot;m&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 78, 74, 18&amp;gt;, &amp;quot;l&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 28, 2, 3&amp;gt;, &amp;quot;k&amp;quot;, ^if_else(^(^number) %in% &amp;lt;dbl: 10,
##             1, 64&amp;gt;, &amp;quot;j&amp;quot;, ^if_else(^(^number) %in% &amp;lt;dbl: 66, 17, 71&amp;gt;, &amp;quot;i&amp;quot;,
##           ^if_else(^(^number) %in% &amp;lt;dbl: 20, 35, 50&amp;gt;, &amp;quot;h&amp;quot;, ^if_else(^(^number)
##              %in% &amp;lt;dbl: 4, 24, 37&amp;gt;, &amp;quot;g&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 40, 73, 7&amp;gt;, &amp;quot;f&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 75, 34, 44&amp;gt;, &amp;quot;e&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 29, 53, 25&amp;gt;, &amp;quot;d&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 55, 59, 67&amp;gt;, &amp;quot;c&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 11, 22, 70&amp;gt;, &amp;quot;b&amp;quot;, ^if_else(^(^number)
##               %in% &amp;lt;dbl: 65, 15, 13&amp;gt;, &amp;quot;a&amp;quot;, &amp;quot;other&amp;quot;))))))))))))))))))))))))))
## env:  0x557e4e781a90&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Yeah, I can’t read that either.&lt;/p&gt;
&lt;p&gt;Proviso 2) As one of my colleagues pointed out; for this particular example, you can do it more easily with a join:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyr, warn.conflicts = FALSE)
tibble(letter = letters, number = numbers) %&amp;gt;% 
            unnest %&amp;gt;% 
            { left_join(number_tbl, .)}&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = &amp;quot;number&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    number letter
##     &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; 
##  1     30 z     
##  2     56 z     
##  3     70 b     
##  4     84 &amp;lt;NA&amp;gt;  
##  5     68 m     
##  6     10 j     
##  7     52 m     
##  8     48 p     
##  9     79 &amp;lt;NA&amp;gt;  
## 10     28 k&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Which would have saved some time, but then you wouldn’t have had the pleasure of seeing that massive if_else statement the computer wrote for you, so, pros and cons I guess. I’m
sure there must be some case where you couldn’t unnest, so you’d need the if_else.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
