<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Tom&#39;s code blog on Tom&#39;s code blog</title>
    <link>/</link>
    <description>Recent content in Tom&#39;s code blog on Tom&#39;s code blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 27 Feb 2019 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>shiny modules part 1.</title>
      <link>/2019/02/27/shiny-modules-part-1/</link>
      <pubDate>Wed, 27 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/27/shiny-modules-part-1/</guid>
      <description>


&lt;p&gt;I’ve been wanting to learn about shiny modules ever since my shiny-building Italian colleague, Dan, pointed out that they might be a good way to keep the code more organised for bigger apps. My first try was overly ambitious and ended in an untagleable mess of modules within modules that didn’t run, so I decided to go with something nice and simple first off, and build from there. In fact, I’d say that’s a principle I’m sticking with from now on when it comes to building apps: start with something simple and add complexity. It makes de-bugging way easier.&lt;/p&gt;
&lt;p&gt;Anyway, for those that don’t know, a ‘module’ in shiny is a bit like a function that creates a bit of UI and the server code that goes with that UI. Of course, if you tried to write a function to make those things normally, you’d hit the problem of duplicate input and output names, which will break the app. What modules do is they create distinct namespaces for each time the module is called, so you don’t get the clash of input and output names. This is great for:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;When your app code would involve lots of repetition (this is the case with my example app)&lt;/li&gt;
&lt;li&gt;When you want the user to be able to create additional parts of the UI themselves. This is potentially the more poweful use IMO, but it’s more complicated, so hopefully I’ll cover that in another blog.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Anyway here’s the module is used&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;compare3dsUI &amp;lt;- function(id) {
  
  ns &amp;lt;- NS(id)
  
 tagList(
   fluidRow(
     column(6, 
      selectInput(inputId =  ns(&amp;quot;follow&amp;quot;), 
                  label = &amp;quot;highlight one country&amp;quot;,
                  choices = gapminder$country %&amp;gt;% unique %&amp;gt;% sort 
                  )
      ),
     column(6,
       sliderTextInput(inputId = ns(&amp;quot;year&amp;quot;),
                       label = &amp;quot;year&amp;quot;, 
                       choices = gapminder$year %&amp;gt;% unique,
                       animate = animationOptions(interval = 2000)
            )
   )
          ), 
   fluidRow(
      column(6, plotlyOutput(ns(&amp;quot;contplot&amp;quot;))),
      column(6, plotlyOutput(ns(&amp;quot;worldplot&amp;quot;)))
   )
)
  
}

compare3ds &amp;lt;- function(input, output, session, cont) {
  
  cont_counts &amp;lt;- reactive({ gapminder %&amp;gt;% filter(continent == cont) %&amp;gt;% 
                                          pull(country)  })
  
  yearData &amp;lt;- reactive({gapminder %&amp;gt;%
                   mutate(colour = if_else(continent == cont, 1, 2) %&amp;gt;%
                                   {if_else(country == input$follow, 3, .)}
                          ) %&amp;gt;%
                   filter(year == input$year)
                   
  })
  
  output$contplot &amp;lt;- renderPlotly(yearData() %&amp;gt;% filter(continent == cont) %&amp;gt;% 
                                    plot_3d(lifeExp, pop, gdpPercap, 
                                            text = country,
                                            title = cont,
                                            color = colour,
                                            colors = if (input$follow %in% cont_counts()) {
                                                             c(&amp;quot;red&amp;quot;, &amp;quot;blue&amp;quot;) } else {
                                                               &amp;quot;red&amp;quot; } 
                                            
                                          )
  )
  
  output$worldplot &amp;lt;- renderPlotly(yearData() %&amp;gt;% 
                                     plot_3d(lifeExp, pop, gdpPercap, 
                                             text = country,
                                             title = &amp;quot;World&amp;quot;,
                                             color = colour,
                                             colors = c(&amp;quot;red&amp;quot;, &amp;quot;grey&amp;quot;, &amp;quot;blue&amp;quot;)
                                          )
  )
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It could be re-written a lot more generic, which would allow it to be used in other apps, but it was late at night when I wrote it and I just couldn’t be bothered. Basically, all you’d need to do it add a load more function arguments in the ‘server’ part of the module for things like colour and variable names etc, and then take those out of the function expression. It uses the plot3d function from &lt;a href=&#34;http://greenwood.rocks/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/&#34;&gt;this blog post&lt;/a&gt;. Then the app UI itself is just:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;source(&amp;quot;compare3ds.R&amp;quot;)

ui &amp;lt;- navbarPage(&amp;quot;Gapminder modules&amp;quot;, theme = &amp;quot;bootstrap.css&amp;quot;,

        tabPanel(title = &amp;quot;Africa&amp;quot;, 
                 compare3dsUI(&amp;quot;Africa&amp;quot;)
              ),
        tabPanel(title = &amp;quot;Europe&amp;quot;, 
                 compare3dsUI(&amp;quot;Europe&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Americas&amp;quot;, 
                 compare3dsUI(&amp;quot;Americas&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Oceania&amp;quot;, 
                 compare3dsUI(&amp;quot;Oceania&amp;quot;)
        ),
        tabPanel(title = &amp;quot;Asia&amp;quot;, 
                 compare3dsUI(&amp;quot;Asia&amp;quot;)
        )
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the server function is just&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Define server logic required to draw a histogram
server &amp;lt;- function(input, output, session) {
  
  Africa &amp;lt;- callModule(compare3ds, &amp;quot;Africa&amp;quot;, cont = &amp;quot;Africa&amp;quot;)
  Europe &amp;lt;- callModule(compare3ds, &amp;quot;Europe&amp;quot;, cont = &amp;quot;Europe&amp;quot;)
  Americas &amp;lt;- callModule(compare3ds, &amp;quot;Americas&amp;quot;, cont = &amp;quot;Americas&amp;quot;)
  Oceania &amp;lt;- callModule(compare3ds, &amp;quot;Oceania&amp;quot;, cont = &amp;quot;Oceania&amp;quot;)
  Asia &amp;lt;- callModule(compare3ds, &amp;quot;Asia&amp;quot;, cont = &amp;quot;Asia&amp;quot;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, basically it save a LOT of typing. Plus it means you can make changes to the module and those changes are replicated. Like I say, I think the real value will be when you combine it will actionButton + insertUI and things like that. I also think that it’s one of those things that once you start using, you’ll never go back, because it just saves you time and keeps your code more compartmentalised, which is all good.&lt;/p&gt;
&lt;p&gt;Here’s the app on shinyapps.io. It’s basically a take on Hans Rosling famous animation, but in 3d and with less data. If only the gapminder package just gave you a bit more up-to-date data that would be nice, I’d like to see how things have changed since 2007.&lt;/p&gt;
&lt;iframe width=&#34;700&#34; height=&#34;400&#34; scrolling=&#34;no&#34; frameborder=&#34;no&#34; src=&#34;https://greenwood.shinyapps.io/gap_mod/&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;It’s a bit clipped, but you can see the full page &lt;a href=&#34;https://greenwood.shinyapps.io/gap_mod/&#34;&gt;here&lt;/a&gt;. Once I’ve figured out some useful application of nested modules I’ll post it as part 2.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>visualising models in 3d with plotly and nse functions</title>
      <link>/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/</link>
      <pubDate>Sat, 09 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/09/visualising-models-in-3d-with-plotly-and-nse-functions/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/plotly-binding/plotly.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/typedarray/typedarray.min.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/jquery/jquery.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/crosstalk/css/crosstalk.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/crosstalk/js/crosstalk.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/plotly-main/plotly-latest.min.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;One of the areas I’m planning to improve on is visualisation. Ultimately, this means D3, but in the meantime I wrote a fairly useful function for showing the fit of a model with two inputs, along with the data, using plotly. First, load the necessary libraries:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(plotly)
library(randomForest)
library(rlang)
library(dplyr)
library(magrittr)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(you could actually write thing function without rlang or magrittr, but it’s just a bit neater with them.) Here’s the function:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot_3d &amp;lt;- function(df, x, y, z) {
  
  x &amp;lt;- enquo(x)
  y &amp;lt;- enquo(y)
  z &amp;lt;- enquo(z) 
  
  # build a model 
  m &amp;lt;- randomForest(expr(!!get_expr(x) ~ !!get_expr(y) + !!get_expr(z)) %&amp;gt;% as.formula, df)
  
  # add the predictions to df
  df %&amp;lt;&amp;gt;% mutate(preds = predict(m, newdata = df ))
  
  plot_ly(df) %&amp;gt;%
    add_trace(x = x, y = y, z = z, 
                opacity = 0.7,
                type = &amp;quot;scatter3d&amp;quot;, 
                mode = &amp;quot;markers&amp;quot;,
                colors = c(&amp;quot;grey&amp;quot;, &amp;quot;blue&amp;quot;),
                name = &amp;quot;true values&amp;quot;,
                size = 10
              ) %&amp;gt;%
    add_trace(x = ~preds, y = y, z = z,
                opacity = 0.7,
                type = &amp;quot;scatter3d&amp;quot;, 
                mode = &amp;quot;markers&amp;quot;,
                name = &amp;quot;modelled values&amp;quot;,
                size = 10
                ) %&amp;gt;%
    layout(scene = list(xaxis = list(title = quo_text(x)),
                        yaxis = list(title = quo_text(y)),
                        zaxis = list(title = quo_text(z))
    )
    )
  
}

economics %&amp;gt;% plot_3d(pce, psavert, uempmed)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:672px;height:480px;&#34; class=&#34;plotly html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;visdat&#34;:{&#34;43416d34b148&#34;:[&#34;function () &#34;,&#34;plotlyVisDat&#34;]},&#34;cur_data&#34;:&#34;43416d34b148&#34;,&#34;attrs&#34;:{&#34;43416d34b148&#34;:{&#34;alpha_stroke&#34;:1,&#34;sizes&#34;:[10,100],&#34;spans&#34;:[1,20],&#34;x&#34;:{},&#34;y&#34;:{},&#34;z&#34;:{},&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;colors&#34;:[&#34;grey&#34;,&#34;blue&#34;],&#34;name&#34;:&#34;true values&#34;,&#34;size&#34;:10,&#34;inherit&#34;:true},&#34;43416d34b148.1&#34;:{&#34;alpha_stroke&#34;:1,&#34;sizes&#34;:[10,100],&#34;spans&#34;:[1,20],&#34;x&#34;:{},&#34;y&#34;:{},&#34;z&#34;:{},&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;modelled values&#34;,&#34;size&#34;:10,&#34;inherit&#34;:true}},&#34;layout&#34;:{&#34;margin&#34;:{&#34;b&#34;:40,&#34;l&#34;:60,&#34;t&#34;:25,&#34;r&#34;:10},&#34;scene&#34;:{&#34;xaxis&#34;:{&#34;title&#34;:&#34;pce&#34;},&#34;yaxis&#34;:{&#34;title&#34;:&#34;psavert&#34;},&#34;zaxis&#34;:{&#34;title&#34;:&#34;uempmed&#34;}},&#34;hovermode&#34;:&#34;closest&#34;,&#34;showlegend&#34;:true},&#34;source&#34;:&#34;A&#34;,&#34;config&#34;:{&#34;modeBarButtonsToAdd&#34;:[{&#34;name&#34;:&#34;Collaborate&#34;,&#34;icon&#34;:{&#34;width&#34;:1000,&#34;ascent&#34;:500,&#34;descent&#34;:-50,&#34;path&#34;:&#34;M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z&#34;},&#34;click&#34;:&#34;function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == &#39;?viewer_pane=1&#39;) {\n          alert(&#39;To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html&#39;);\n        } else {\n          window.open(&#39;https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html&#39;, &#39;_blank&#39;);\n        }\n      }&#34;}],&#34;cloud&#34;:false},&#34;data&#34;:[{&#34;x&#34;:[507.4,510.5,516.3,512.9,518.1,525.8,531.5,534.2,544.9,544.6,550.4,556.8,563.8,567.6,568.8,572.3,577.4,577.2,584.2,589.5,589.7,594.7,601.1,601.7,603.5,610.8,614.1,619.4,621.4,623.7,629.6,634.9,633.2,637,643.4,647.2,649.5,653.9,660.1,659.3,657.6,666.6,677.2,680.4,683,689.8,692.2,700.8,699.9,706,714.1,716.9,722.1,729.6,732.6,737.3,750.4,753.8,759.2,762.9,771.2,777.7,782.5,796.3,801.8,807.5,817.9,827.2,834.2,837.2,843.1,845.8,855.7,854.9,870.9,869.8,878.6,878.4,886.4,891.6,903.3,912.7,924.3,929.9,939.8,956.6,956.8,961,958,963.6,977.4,991.3,992.6,997.2,1021.2,1029.1,1042.2,1049.4,1057.2,1063.2,1078,1094.4,1109.5,1110.1,1117.3,1127.8,1125.1,1142.9,1152.1,1160.5,1171.4,1179.5,1191.7,1214.1,1217.4,1233.7,1240.7,1249.7,1259.6,1266.3,1283.2,1288.5,1297.4,1314.3,1330,1339.3,1333,1358.9,1381.4,1400.2,1415.9,1429.8,1430.8,1451,1456.9,1471,1484.7,1500.5,1506.3,1521.6,1535,1542.3,1562.7,1579.6,1590.1,1619.7,1638.1,1646,1661.7,1670.7,1701.6,1705.6,1712.4,1699.5,1704.3,1723,1751.2,1767.7,1784.1,1820.4,1830.2,1855.5,1874.7,1889.4,1908.1,1909.1,1918.2,1938.5,1945.7,1969.8,1968.2,1966.2,1972.4,1989.9,1997.4,2021.4,2024.4,2027.2,2045.9,2050.2,2075.1,2083.7,2108.9,2130.7,2154.7,2167.4,2180.1,2183.1,2208.6,2231.8,2251,2280.8,2309,2324.8,2339.1,2361.8,2370.4,2397.9,2423.8,2408.1,2436.4,2462.6,2479.8,2501.2,2500.5,2518.4,2540.3,2538.2,2578.6,2590,2626.3,2648.6,2656.8,2668.4,2705.9,2699.3,2725.9,2762.7,2805.6,2767.1,2782.7,2822.8,2838.3,2831.2,2834.7,2846.5,2869,2873.5,2893.4,2911.1,2984.6,2945.9,2941.7,3010.8,2949.9,3016.5,3028.4,3054.1,3063.9,3088.4,3110.7,3147,3142.9,3151.1,3160.9,3190.9,3230.7,3238.5,3277.8,3280.4,3311,3335.6,3359.3,3384.3,3391.4,3430.4,3447,3476.3,3499.9,3503.9,3514.5,3558.6,3567.5,3582.4,3601.7,3636.8,3638.1,3650,3659.7,3700.7,3747.2,3744.8,3771.5,3786.7,3792.5,3821.3,3838.5,3865,3886.7,3887.1,3888.4,3877.8,3857.6,3883.3,3929.7,3923.9,3950,3957.1,3982.4,3985.4,4001.2,3992.9,4020.6,4037.7,4101.9,4116.8,4134.3,4149,4176.1,4195,4223,4239.3,4273.9,4303.5,4319.5,4355.6,4359.7,4374.3,4371.4,4412.4,4441.3,4458.8,4487.7,4499.9,4530.5,4552,4573.4,4590.7,4604.8,4652.3,4665.4,4690.7,4689.2,4728.8,4740.8,4783,4795.5,4833.3,4846,4862.3,4871.9,4871.7,4906.5,4911.5,4954.4,4999,4991.8,5027.1,5042.5,5035.9,5077.8,5120.1,5108.9,5156.1,5196.4,5231.6,5247.2,5253.7,5275.8,5299,5320,5351.5,5375,5401.7,5434.9,5457.7,5477.6,5482.8,5484.3,5518.2,5573,5611.8,5625.6,5661.2,5685.2,5716.4,5714.4,5748.4,5775,5812.9,5863.3,5897.2,5915.6,5951,5991.8,6025.8,6042.7,6098.2,6099.1,6128.2,6159.7,6223.6,6253.4,6281.9,6309.5,6354.8,6407.4,6431.2,6467.2,6568.2,6564.7,6648.7,6714.8,6701,6737.2,6773.6,6793.7,6828.7,6913.1,6919.6,6934.5,6979.1,7009.8,7029.3,7022.1,7036.2,7083.1,7097.1,7109.2,7146.1,7054.8,7250.2,7209.6,7190,7217.7,7259.7,7276.7,7345.6,7321.8,7366.1,7424.2,7449,7426.1,7469.3,7499.8,7552.6,7579.5,7573.6,7627.5,7661.7,7669.2,7722.9,7783.8,7878.9,7874,7890.6,7950.4,7974.3,8037.3,8072.1,8121,8141.6,8212.9,8204.6,8270.7,8294.4,8373,8417.9,8458.4,8516.5,8521.2,8575.7,8622.5,8715.9,8680.6,8775.3,8867.9,8872.6,8923.6,8959.6,8987.7,9026.8,9100.1,9134.7,9168.1,9223.3,9254.1,9283.8,9360.4,9368.6,9393.9,9413.3,9431.2,9516.5,9553.1,9590.8,9631.6,9670.6,9708.9,9723.3,9759.6,9800.6,9837.5,9853.9,9928.6,9947.6,9963.2,9955.7,10004.2,10044.6,10093.3,10149.4,10151.1,10140.3,10083.2,9983.3,9851.2,9744.2,9792.1,9775.7,9742.9,9741.9,9759.7,9807.6,9835.2,9961.9,9875.4,9924.6,9946.1,10000.6,10003.4,10034.7,10095.5,10106.9,10140.2,10165.9,10184.3,10247.1,10268.9,10343.7,10399.8,10436.1,10474.7,10512.4,10583.5,10624.6,10653.1,10676.4,10727.1,10745.6,10790.6,10827.6,10828.7,10827.3,10905.5,10979.2,10994.3,11030.2,11029,11032.5,11074.8,11104.8,11179.6,11199.9,11222.8,11245.2,11303.2,11371.4,11378.8,11373.3,11407.1,11462.4,11484.7,11511.6,11559.6,11602.1,11671.5,11686.3,11663.9,11714.4,11807.1,11825.2,11864.3,11922.6,11944.4,12017,12044.6,12096.4,12142.2,12122,12080.8,12095.9,12161.5,12158.9],&#34;y&#34;:[12.5,12.5,11.7,12.5,12.5,12.1,11.7,12.2,11.6,12.2,12,11.6,10.6,10.4,10.4,10.6,10.4,10.9,10,9.4,9.9,9.5,10,10.9,11.7,11.5,11.5,11.3,11.5,11.7,11.7,11.6,12.3,13.3,12.3,11.7,13.2,13.1,12.9,13,13.3,12.9,13.1,13.1,13.3,13,13.4,14.4,13.6,13.6,12.9,13,12.8,12.9,12.4,12.6,11.5,11.3,11.5,11.4,11.4,11.8,12,12.7,13.4,13.4,12.1,12.2,12.4,12.8,12.8,13.2,12.8,13.6,12.8,14,14,14.4,14,13.8,13,12.7,12.3,12.5,12.7,11.6,12.3,13,13.4,13.6,12.8,12.1,12.3,13.9,17,13.9,12.3,12.6,12.6,13,12.3,11.5,11.3,11.9,11.8,11.2,11.8,10.9,11.2,11.2,10.8,10.6,10.9,9.9,9.8,8.5,9.8,9.9,9.8,10.2,10.1,10.5,10.7,10.7,10.8,11,11.4,10.7,10.5,10.3,9.8,9.5,10.3,9.9,10,10.2,10,10,10.6,10.5,10.7,10.4,9.8,9.3,10,9.2,8.9,9.3,9.4,9.8,9.6,9.8,9.8,10.5,10.6,10.4,10.5,10.6,11.1,11,11.5,11.2,10.5,10.4,10.3,10.3,10.4,10.2,11.7,11.4,11.9,12.5,12.7,12,12.2,11.6,11.7,12.4,11.7,11.6,12,11.9,11.1,10.7,10.3,10.3,10.4,10.5,10,9.6,9.4,8.5,9,8.7,9,9.1,9.7,9.5,9.4,11.1,10.9,10.9,10.5,10.5,11,11.2,11.2,11.2,10.3,10.6,9.7,8.5,8.1,9.4,10.5,9,8.5,7.5,6.7,8.5,8.4,8,8,8.7,9.3,9.1,8.6,8.8,8.7,8.4,6.6,7.8,8.2,6.4,9.1,7.9,7.9,3.8,7.5,7,6.8,6.5,7,7.6,7.9,8,7.5,7.9,7.5,8.1,7.7,7.8,7.9,7.8,8.2,8,7.7,7.7,8,8.4,8.9,7.9,7.6,7.6,7.7,7.1,7.5,7.9,8,7.2,7.4,8.1,7.8,8.2,8,7.9,8,7.5,7.5,7.3,7.4,8.2,8.7,8.3,7.4,8,7.7,8.2,7.6,7.9,8.1,8.6,8.4,9.1,8.8,9.2,9.2,9.4,9.4,9.5,9.1,9.2,8.2,7.4,7.3,9.9,8.3,8.4,8.3,8.2,7.7,7.2,7,7.1,6.3,5.6,5.6,8.4,6.4,5.9,6.2,5.8,7.1,6.3,6.4,5.9,6.2,6.5,6.4,6.5,6.9,7.3,7,6.3,6.5,6.1,6.4,6.1,6.1,6.5,6,5.5,6.1,6.1,6,5,6.1,6.5,6.1,5.9,6,5.8,5.8,5.7,5.6,5.7,5.8,5.9,6.2,6,5.5,5.4,5.6,5.6,5.8,5.8,6.7,6.8,6.9,6.6,6.3,6.2,6.3,6.2,5.8,5.6,5.7,5.2,5.7,5.6,5.3,4.5,4.3,4.2,4.1,4,3.5,3.9,4.1,3.7,4.7,4.2,3.9,4.4,4.2,4.2,4.6,4.6,3.8,4,3.8,3.5,4,4.1,4.5,4.3,3.7,3.7,5,6.1,6.3,2.7,3.4,3.8,5.6,5.3,5.3,5.1,5.6,5.4,4.6,4.4,4.9,4.7,4.7,4.5,4.5,4.7,4.6,4.6,5.1,4.9,5.5,5.3,4.5,4.6,4.7,4.8,4.5,4.5,4.5,4.7,4.7,5,4.5,4.6,3.9,3.8,3.4,6.3,2.9,2.7,2.7,2.1,3,2.2,1.9,2.4,2.3,2.6,2.7,2.8,3.7,3.8,3.7,3.4,3.2,3.4,2.9,3,3,3.1,3.2,3,3,3.3,3.6,3.2,3,2.8,2.8,2.6,2.8,2.8,2.5,3,3.4,3.9,4,3.5,7.9,5.6,4.4,3.7,4.4,5.4,6.3,6.5,6.5,5.9,6.1,6.7,8.1,6.7,6,4.9,5.9,5.4,5.7,5.7,5.6,5.2,5,5.6,6,5.9,5.9,5.8,5.6,5.4,5.3,5.9,6.2,6.4,6,5.9,5.9,6.1,6.3,6.2,5.7,5.5,5.6,6.4,6.6,6.7,6.9,7,7,7.1,6.6,6.4,6.5,7.1,8.2,10.5,4.5,4.7,4.9,5.1,5.2,5.3,5.1,5.3,5.2,4.7,4.3,4.1,4.9,5,4.8,5,5.1,5.1,5.1,4.7,4.6,4.6,4.5,5,5.5,5.7,5.2,5.6],&#34;z&#34;:[4.5,4.7,4.6,4.9,4.7,4.8,5.1,4.5,4.1,4.6,4.4,4.4,4.5,4.2,4.6,4.8,4.4,4.4,4.4,4.9,4,4,4.2,4.4,4.4,4.4,4.7,4.5,4.8,4.6,4.6,4.5,4.6,4.1,4.7,4.9,5.1,5.4,5.2,5.2,5.6,5.9,6.2,6.3,6.4,6.5,6.7,5.7,6.2,6.4,5.8,6.5,6.4,6.2,6.2,6.6,6.6,6.7,6.6,5.4,6.1,6,5.6,5.7,5.7,6.1,5.7,5.2,5.5,5,4.9,5,5.2,4.9,5.4,5.5,5.1,4.7,5,5.1,4.8,5,4.6,5.3,5.7,5,5.3,5.5,5.2,5.7,6.3,7.1,7.2,8.7,9.4,8.8,8.6,9.2,9.2,8.6,9.5,9,9,8.2,8.7,8.2,8.3,7.8,7.7,7.9,7.8,7.7,8.4,8,7.5,7.2,7.2,7.3,7.9,6.2,7.1,7,6.7,6.9,7,6.8,6.5,6.7,6.2,6.1,5.7,6,5.8,5.8,5.6,5.9,5.5,5.6,5.9,5.9,5.9,5.4,5.6,5.6,5.9,4.8,5.5,5.5,5.3,5.7,5.3,5.8,6,5.8,5.7,6.4,7,7.5,7.7,7.5,7.7,7.5,7.4,7.1,7.1,7.4,6.9,6.6,7.1,7.2,6.8,6.8,6.9,6.9,7.1,7.5,7.7,8.1,8.5,9.5,8.5,8.7,9.5,9.7,10,10.2,11.1,9.8,10.4,10.9,12.3,11.3,10.1,9.3,9.3,9.4,9.3,8.7,9.1,8.3,8.3,8.2,9.1,7.5,7.5,7.3,7.6,7.2,7.2,7.3,6.8,7.1,7.1,6.9,6.9,6.6,6.9,7.1,6.9,7.1,7,6.8,6.7,6.9,6.8,6.7,6.8,7,6.9,7.1,7.4,7,7.1,7.1,6.9,6.6,6.6,7.1,6.6,6.5,6.5,6.4,6,6.3,6.2,6,6.2,6.3,6.4,5.9,5.9,5.8,6.1,5.9,5.7,5.6,5.7,5.9,5.6,5.4,5.4,5.4,5.3,5.4,5.6,5,4.9,4.9,4.8,4.9,5.1,5.3,5.1,4.8,5.2,5.2,5.4,5.4,5.6,5.8,5.7,5.9,6,6.2,6.7,6.6,6.4,6.9,7,7.3,6.8,7.2,7.5,7.8,8.1,8.2,8.3,8.5,8.8,8.7,8.6,8.8,8.6,9,9,9.3,8.6,8.5,8.5,8.4,8.1,8.3,8.2,8.2,8.3,8,8.3,8.3,8.6,9.2,9.3,9.1,9.2,9.3,9,8.9,9.2,10,9,8.7,8,8.1,8.3,8.3,9.1,7.9,8.5,8.3,7.9,8.2,8,8.3,8.3,7.8,8.3,8.6,8.6,8.3,8.3,8.4,8.5,8.3,7.7,7.8,7.8,8.1,7.9,8.3,8,8,8.3,7.8,8.2,7.7,7.6,7.5,7.4,7,6.8,6.7,6,6.9,6.7,6.8,6.7,5.8,6.6,6.8,6.9,6.8,6.8,6.2,6.5,6.3,5.8,6.5,6,6.1,6.2,5.8,5.8,6.1,6,6.1,5.8,5.7,6,6.3,5.2,6.1,6.1,6,5.8,6.1,6.6,5.9,6.3,6,6.8,6.9,7.2,7.3,7.7,8.2,8.4,8.3,8.4,8.9,9.5,11,8.9,9,9.5,9.6,9.3,9.6,9.6,9.5,9.7,10.2,9.9,11.5,10.3,10.1,10.2,10.4,10.3,10.4,10.6,10.2,10.2,9.5,9.9,11,8.9,9.2,9.6,9.5,9.7,9.5,9.4,9.2,9.3,9,9.1,9,8.8,9.2,8.4,8.6,8.5,8.7,8.6,9.1,8.7,8.4,8.5,7.3,8,8.4,8,7.9,8.3,7.5,8.3,8.5,9.1,8.6,8.2,7.7,8.7,8.8,8.7,8.4,8.6,8.4,9,8.7,8.7,9.4,7.9,9,9.7,9.7,10.2,10.4,9.8,10.5,10.7,11.7,12.3,13.1,14.2,17.2,16,16.3,17.8,18.9,19.8,20.1,20,19.9,20.4,22.1,22.3,25.2,22.3,21,20.3,21.2,21,21.9,21.6,21.1,21.5,20.9,21.6,22.3,22,22.4,22,20.5,20.9,20.5,21,19.8,19.2,19.1,19.9,20.1,17.5,18.5,18.8,19.7,18.5,17.6,16.2,17.5,17.7,17.1,17,16.6,16.3,16.8,16.5,16.1,17,17,15.9,16.2,15.9,15.6,14.5,13.2,13.5,13.3,13.3,13.5,12.8,12.6,13.4,13.1,12.2,11.7],&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;true values&#34;,&#34;marker&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;size&#34;:[55],&#34;sizemode&#34;:&#34;area&#34;,&#34;line&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;}},&#34;textfont&#34;:{&#34;size&#34;:55},&#34;error_y&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;error_x&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;line&#34;:{&#34;color&#34;:&#34;rgba(31,119,180,1)&#34;,&#34;width&#34;:55},&#34;frame&#34;:null},{&#34;x&#34;:[561.942544069264,567.156186926407,603.829623638583,646.07173474026,567.156186926407,648.436274761904,710.379037633478,568.218411269841,583.785710901876,602.747131098901,583.348444134198,592.116960988456,601.856972063492,593.19196900433,599.080606769896,723.105169761903,593.440420281386,611.854922150073,603.784473499279,1138.19117821068,637.736853333335,802.714191904763,604.668981666667,611.854922150073,588.386370404041,600.891565800865,615.427557698413,642.206838888889,670.700110079365,603.829623638583,603.829623638583,603.417049949495,702.704967193362,656.271249047619,655.94093047619,651.829238766234,753.650768347763,764.718675238096,756.051814816849,759.449062912088,761.360514603174,789.784066414141,716.84564945055,731.420961904763,716.485749603175,749.528615238096,828.143461666668,820.780447812405,752.000614212455,744.431949603175,839.456957943722,749.528615238096,806.890916031745,741.665334688644,819.028188974359,826.833092619046,821.985441984127,998.530698333333,821.985441984127,876.704138571429,931.437132539683,864.541258412699,830.320761269842,889.296440272724,838.83168130447,805.877593492064,835.46400535209,815.573897991454,865.134116666668,861.982070433455,812.311596623376,816.702503290598,832.01984481685,847.574932813853,869.515516190477,869.401988095237,873.663515490619,784.664605317461,882.536769957264,873.283518823952,820.938513571428,877.103529004885,702.704967193362,921.017088831169,889.296440272724,810.178439589299,930.121984999999,843.378516190477,860.279347435897,863.081606066375,854.285105714286,1522.5689019716,1451.9989947619,1201.32653471307,1250.29936142857,1245.72438222222,1292.03478931818,1206.25898952381,1206.25898952381,1213.04114241342,1429.48873507936,1397.31505611111,1395.438425,1515.88324014929,1494.63330344322,1590.3055938073,1539.9786768023,1482.38042817461,1584.68866619048,1579.32523532468,1384.55172507937,1547.71683621934,2020.2027995289,1546.2912741847,1385.36176917028,2537.13209305194,1419.63290393939,1443.86485831169,1571.34698584415,1427.69903564103,1463.22945713033,1766.81431123377,1366.02611904762,1649.46852809229,1468.98763533189,1685.62161251526,1001.41011904762,1366.02611904762,1486.46752540293,1449.82208468254,1561.41200402009,1724.28861150794,1539.82264976912,1577.95378691198,1488.02115730159,1523.05675744589,1480.5189068254,1488.02115730159,1560.69103427129,1587.83069577922,1498.0012222078,1513.97625019481,1556.13550729437,1738.80415904762,1537.74972681097,1867.10950547619,2447.49930597403,1712.74138857143,1712.02680634921,1561.41200402009,1652.72201809524,1632.42735777778,1607.28973062771,1638.56751357865,1564.13470275747,1591.47965217893,1766.81431123377,2004.81254848485,1683.14526217172,2049.95675658009,1758.08109947331,2130.03091210678,2086.33674026695,1859.07201343624,1922.98095347953,2060.92895857143,2021.08169662043,1665.51693261905,1850.9452799081,1948.07037785714,1812.08481299145,1724.28236467976,1720.62438690181,1889.42713356848,1592.72114181287,1968.38546573593,1819.82352074315,1686.81911285714,1881.99359945055,1856.80270222222,1877.03797802198,1631.06923582418,2097.28718698413,2254.09742166666,2255.46462857143,2350.17234809524,2504.21014495671,2357.54122666667,2500.86687444444,2598.30395333334,4204.09809761905,2891.35102646465,2430.39866190476,2618.76474396826,2527.15889253968,2591.5427219697,2714.93466619047,3177.65680534798,2860.73356904763,2118.62688394516,2149.9431672785,1991.53694300644,2372.02312,2142.05311938672,2049.95675658009,2352.18157616162,2250.42873727273,2251.60492957431,2149.32228666666,2223.46813539683,2292.49856553114,2575.20556950406,2987.15851827751,2703.93313340975,2075.54992827988,2747.51457500001,2641.68269846747,3038.61935949684,4279.81422941179,2575.20556950406,3061.28484517316,3241.29113877789,3153.17048126263,2956.64359470124,2706.3664174359,2868.26868554112,3000.58601100732,2936.6520430303,2956.64359470124,2929.35235803942,4304.71155428572,3278.75091350649,3080.68878759209,4155.44109101562,2906.74020942707,3246.54583750749,3246.54583750749,5248.17637813323,3232.09725534632,3431.98205071428,3770.76543809524,3907.44785714286,3538.6138615873,3297.26093404762,3295.88700259296,3339.36414197691,3274.56322900322,3285.49003195194,3362.51985725108,3450.1959667316,3432.47174260462,3432.3046125469,3297.09871758686,3369.41242577922,3614.25065734982,3499.73261951659,3533.72431827333,3432.47174260462,3499.73261951659,3436.5266219264,2833.07393621213,3638.76950991009,3624.09643404761,3610.2864321645,3547.37930825396,3749.42124027473,3647.51874903319,3659.39154984515,3574.89875832612,3712.2521704329,3731.82796533189,3672.13183738095,3670.68350096681,3600.9508542352,3737.16375665945,3747.59737774558,3649.92812334776,3730.27942624098,3710.01471733044,3785.64198865801,3816.87386509873,3640.82607969697,3248.31114650794,3692.69079667278,3722.69981222222,3390.07584824675,3548.26261285714,3578.60444893645,3494.64237969696,4043.21157076145,3501.35050489622,3198.01388880951,3765.41903103175,3895.78307371573,3978.85323190476,4092.91003069043,4127.41185599056,3766.6597870696,3663.40032476191,3177.65680534798,3990.06503176407,4013.78305095239,4376.21475506133,4440.10133571429,4479.97348404762,3008.95711952381,4366.37335622295,4345.68928445055,4413.55602016483,4503.46534098633,4960.78161166667,4628.34355742995,4680.1588898174,4677.78444449994,5054.3401202316,5306.74510585829,5310.32049380995,4423.05624170484,4800.23725390305,4956.10875473305,4888.80055587301,5186.10620425408,4594.96935507936,5083.64594735209,4834.56085182539,5096.6413105267,4887.04893746032,6824.55022873015,4834.56085182539,4995.24288526862,5067.0077363492,4699.94399809524,4721.2887563008,5054.3401202316,4929.55724730158,5289.16390308747,4961.84304556166,5153.33660919929,5289.16390308747,4991.67444045232,5319.31518968254,5462.1553879228,5153.33660919929,5192.57644713509,5251.28308190547,6493.21514874432,5172.04208349845,4986.9654316712,5153.33660919929,5574.50400346829,5354.69545452991,5331.13436207586,5580.49649768842,5486.51781282107,5477.60529411226,5422.05896210679,5540.13124203186,5297.52259463274,5277.44542801587,5319.31518968254,5462.1553879228,5976.29468285714,5438.81147471611,5663.68808746724,5737.47040774614,5740.77023885725,4663.06028642857,4804.24889160173,5075.84680007659,4893.91512023809,5682.36441608224,6074.09009814195,5994.35400624098,5996.89821150516,5968.82484139694,5996.81103217864,6001.04343837663,6340.82065404487,6125.77476199477,6045.2651554587,6379.89633943808,6490.78775272616,6367.92496222221,6485.11055063492,6633.51946782828,6431.32686619047,6885.10480753968,6703.90031533911,6481.65188230769,6770.46007163781,6646.19052980188,6723.15894097403,6725.56671230159,6808.10247105339,6643.76751012987,6479.82577035355,6765.969589127,6666.97639571429,6366.11595155846,6821.24758486291,6634.22059499279,6885.10480753968,6763.21575211399,6771.0467453391,6696.04368708514,6773.59872687592,6846.96891952383,6874.98547992065,6635.85102650518,6278.96136105627,6119.76555386002,8079.08979190478,8210.55873357865,7322.35445621712,6781.08032825877,6684.29640701168,7044.51667326267,7419.76399801588,7831.341161587,8306.43074000001,7754.10820539683,8287.83447026696,7619.5469248485,7685.49230951326,7690.33480356087,7698.64382681818,7698.64382681818,7733.65107650461,7869.69246301587,7910.64763166668,7834.596815,8408.31823714285,8031.97894476189,7842.43311317098,8007.95737523088,8063.44168000001,7968.97126808469,8122.7611423199,8157.99673583694,8007.95737523088,8007.95737523088,7733.65107650461,7968.25688617992,8027.08466809526,7848.51082727273,7933.03659357142,8712.60806420635,8623.05288941558,9088.90016333333,7371.73647450216,8824.64383729439,8652.18543000001,8566.64294238096,8845.65906801587,8925.24420077923,8846.13426801587,9080.01221880952,8738.92750000001,9075.75781905994,9250.4826644586,9062.69108151406,9539.22435915028,9008.59505683956,8927.8575689394,9342.99517153847,9266.55479144088,9341.59061405373,8019.09392714285,9255.61724689754,9505.92504126771,9283.01966397547,9233.64268738095,9196.96510492711,8943.50152150794,9256.62733649998,9358.92592199023,9354.35743000001,9378.06243699828,9227.28225450716,9003.02921396824,9539.22435915028,9411.29239071429,9539.22435915028,9539.69758452889,9379.72096588718,9505.92504126771,9342.01356182541,9485.55934709404,9514.36650685595,9211.62518833334,6912.97900356364,7974.74115499248,9234.51170502886,9383.81249142856,9361.69086153682,8586.8735647619,8205.95313536797,8853.31976373016,8949.33470706349,9923.01199765514,9760.25332280609,10096.4824121429,9083.71414333335,10141.3536221428,10063.1351401587,10978.1502614286,10107.8740369192,10230.2447990476,10140.2276858369,10115.4084091703,10127.7331848915,10358.9397570635,10461.1345524459,10352.7268715582,10245.0108513492,10260.8137465224,10275.677618189,10303.3535564763,10247.9259148915,10336.9413790476,10424.3081817424,10464.9160747763,10584.62008,10644.7657784921,10413.5090539683,10512.6432047763,10484.7743647763,10418.8764844728,10620.8637433333,10596.62884,10513.9360729798,10559.10004,10514.3122115582,10757.2186918254,10810.248647619,10786.0658821429,10931.38825,10915.5797733333,10888.8320366667,10825.7558633333,10706.351097619,10873.7328784921,10899.1200603968,10871.1241033333,10275.7825038095,8868.60823357145,11451.6264404762,11347.6996727961,11067.9365480952,11432.9478588095,11406.9194726984,11316.2812217424,11348.7521321429,11317.5034950757,11407.7657526984,11499.7430661294,11500.4126661905,11495.5629995238,11466.24125,11485.7492987951,11620.5961369231,11737.9006754618,11817.4897045238,11899.383857381,11905.2306407143,11873.0936727961,11944.1639438095,11957.3931538095,11839.9695785714,11799.9878821284,11619.6866933333,11348.4030801227,11448.6177884127,10873.6998389391],&#34;y&#34;:[12.5,12.5,11.7,12.5,12.5,12.1,11.7,12.2,11.6,12.2,12,11.6,10.6,10.4,10.4,10.6,10.4,10.9,10,9.4,9.9,9.5,10,10.9,11.7,11.5,11.5,11.3,11.5,11.7,11.7,11.6,12.3,13.3,12.3,11.7,13.2,13.1,12.9,13,13.3,12.9,13.1,13.1,13.3,13,13.4,14.4,13.6,13.6,12.9,13,12.8,12.9,12.4,12.6,11.5,11.3,11.5,11.4,11.4,11.8,12,12.7,13.4,13.4,12.1,12.2,12.4,12.8,12.8,13.2,12.8,13.6,12.8,14,14,14.4,14,13.8,13,12.7,12.3,12.5,12.7,11.6,12.3,13,13.4,13.6,12.8,12.1,12.3,13.9,17,13.9,12.3,12.6,12.6,13,12.3,11.5,11.3,11.9,11.8,11.2,11.8,10.9,11.2,11.2,10.8,10.6,10.9,9.9,9.8,8.5,9.8,9.9,9.8,10.2,10.1,10.5,10.7,10.7,10.8,11,11.4,10.7,10.5,10.3,9.8,9.5,10.3,9.9,10,10.2,10,10,10.6,10.5,10.7,10.4,9.8,9.3,10,9.2,8.9,9.3,9.4,9.8,9.6,9.8,9.8,10.5,10.6,10.4,10.5,10.6,11.1,11,11.5,11.2,10.5,10.4,10.3,10.3,10.4,10.2,11.7,11.4,11.9,12.5,12.7,12,12.2,11.6,11.7,12.4,11.7,11.6,12,11.9,11.1,10.7,10.3,10.3,10.4,10.5,10,9.6,9.4,8.5,9,8.7,9,9.1,9.7,9.5,9.4,11.1,10.9,10.9,10.5,10.5,11,11.2,11.2,11.2,10.3,10.6,9.7,8.5,8.1,9.4,10.5,9,8.5,7.5,6.7,8.5,8.4,8,8,8.7,9.3,9.1,8.6,8.8,8.7,8.4,6.6,7.8,8.2,6.4,9.1,7.9,7.9,3.8,7.5,7,6.8,6.5,7,7.6,7.9,8,7.5,7.9,7.5,8.1,7.7,7.8,7.9,7.8,8.2,8,7.7,7.7,8,8.4,8.9,7.9,7.6,7.6,7.7,7.1,7.5,7.9,8,7.2,7.4,8.1,7.8,8.2,8,7.9,8,7.5,7.5,7.3,7.4,8.2,8.7,8.3,7.4,8,7.7,8.2,7.6,7.9,8.1,8.6,8.4,9.1,8.8,9.2,9.2,9.4,9.4,9.5,9.1,9.2,8.2,7.4,7.3,9.9,8.3,8.4,8.3,8.2,7.7,7.2,7,7.1,6.3,5.6,5.6,8.4,6.4,5.9,6.2,5.8,7.1,6.3,6.4,5.9,6.2,6.5,6.4,6.5,6.9,7.3,7,6.3,6.5,6.1,6.4,6.1,6.1,6.5,6,5.5,6.1,6.1,6,5,6.1,6.5,6.1,5.9,6,5.8,5.8,5.7,5.6,5.7,5.8,5.9,6.2,6,5.5,5.4,5.6,5.6,5.8,5.8,6.7,6.8,6.9,6.6,6.3,6.2,6.3,6.2,5.8,5.6,5.7,5.2,5.7,5.6,5.3,4.5,4.3,4.2,4.1,4,3.5,3.9,4.1,3.7,4.7,4.2,3.9,4.4,4.2,4.2,4.6,4.6,3.8,4,3.8,3.5,4,4.1,4.5,4.3,3.7,3.7,5,6.1,6.3,2.7,3.4,3.8,5.6,5.3,5.3,5.1,5.6,5.4,4.6,4.4,4.9,4.7,4.7,4.5,4.5,4.7,4.6,4.6,5.1,4.9,5.5,5.3,4.5,4.6,4.7,4.8,4.5,4.5,4.5,4.7,4.7,5,4.5,4.6,3.9,3.8,3.4,6.3,2.9,2.7,2.7,2.1,3,2.2,1.9,2.4,2.3,2.6,2.7,2.8,3.7,3.8,3.7,3.4,3.2,3.4,2.9,3,3,3.1,3.2,3,3,3.3,3.6,3.2,3,2.8,2.8,2.6,2.8,2.8,2.5,3,3.4,3.9,4,3.5,7.9,5.6,4.4,3.7,4.4,5.4,6.3,6.5,6.5,5.9,6.1,6.7,8.1,6.7,6,4.9,5.9,5.4,5.7,5.7,5.6,5.2,5,5.6,6,5.9,5.9,5.8,5.6,5.4,5.3,5.9,6.2,6.4,6,5.9,5.9,6.1,6.3,6.2,5.7,5.5,5.6,6.4,6.6,6.7,6.9,7,7,7.1,6.6,6.4,6.5,7.1,8.2,10.5,4.5,4.7,4.9,5.1,5.2,5.3,5.1,5.3,5.2,4.7,4.3,4.1,4.9,5,4.8,5,5.1,5.1,5.1,4.7,4.6,4.6,4.5,5,5.5,5.7,5.2,5.6],&#34;z&#34;:[4.5,4.7,4.6,4.9,4.7,4.8,5.1,4.5,4.1,4.6,4.4,4.4,4.5,4.2,4.6,4.8,4.4,4.4,4.4,4.9,4,4,4.2,4.4,4.4,4.4,4.7,4.5,4.8,4.6,4.6,4.5,4.6,4.1,4.7,4.9,5.1,5.4,5.2,5.2,5.6,5.9,6.2,6.3,6.4,6.5,6.7,5.7,6.2,6.4,5.8,6.5,6.4,6.2,6.2,6.6,6.6,6.7,6.6,5.4,6.1,6,5.6,5.7,5.7,6.1,5.7,5.2,5.5,5,4.9,5,5.2,4.9,5.4,5.5,5.1,4.7,5,5.1,4.8,5,4.6,5.3,5.7,5,5.3,5.5,5.2,5.7,6.3,7.1,7.2,8.7,9.4,8.8,8.6,9.2,9.2,8.6,9.5,9,9,8.2,8.7,8.2,8.3,7.8,7.7,7.9,7.8,7.7,8.4,8,7.5,7.2,7.2,7.3,7.9,6.2,7.1,7,6.7,6.9,7,6.8,6.5,6.7,6.2,6.1,5.7,6,5.8,5.8,5.6,5.9,5.5,5.6,5.9,5.9,5.9,5.4,5.6,5.6,5.9,4.8,5.5,5.5,5.3,5.7,5.3,5.8,6,5.8,5.7,6.4,7,7.5,7.7,7.5,7.7,7.5,7.4,7.1,7.1,7.4,6.9,6.6,7.1,7.2,6.8,6.8,6.9,6.9,7.1,7.5,7.7,8.1,8.5,9.5,8.5,8.7,9.5,9.7,10,10.2,11.1,9.8,10.4,10.9,12.3,11.3,10.1,9.3,9.3,9.4,9.3,8.7,9.1,8.3,8.3,8.2,9.1,7.5,7.5,7.3,7.6,7.2,7.2,7.3,6.8,7.1,7.1,6.9,6.9,6.6,6.9,7.1,6.9,7.1,7,6.8,6.7,6.9,6.8,6.7,6.8,7,6.9,7.1,7.4,7,7.1,7.1,6.9,6.6,6.6,7.1,6.6,6.5,6.5,6.4,6,6.3,6.2,6,6.2,6.3,6.4,5.9,5.9,5.8,6.1,5.9,5.7,5.6,5.7,5.9,5.6,5.4,5.4,5.4,5.3,5.4,5.6,5,4.9,4.9,4.8,4.9,5.1,5.3,5.1,4.8,5.2,5.2,5.4,5.4,5.6,5.8,5.7,5.9,6,6.2,6.7,6.6,6.4,6.9,7,7.3,6.8,7.2,7.5,7.8,8.1,8.2,8.3,8.5,8.8,8.7,8.6,8.8,8.6,9,9,9.3,8.6,8.5,8.5,8.4,8.1,8.3,8.2,8.2,8.3,8,8.3,8.3,8.6,9.2,9.3,9.1,9.2,9.3,9,8.9,9.2,10,9,8.7,8,8.1,8.3,8.3,9.1,7.9,8.5,8.3,7.9,8.2,8,8.3,8.3,7.8,8.3,8.6,8.6,8.3,8.3,8.4,8.5,8.3,7.7,7.8,7.8,8.1,7.9,8.3,8,8,8.3,7.8,8.2,7.7,7.6,7.5,7.4,7,6.8,6.7,6,6.9,6.7,6.8,6.7,5.8,6.6,6.8,6.9,6.8,6.8,6.2,6.5,6.3,5.8,6.5,6,6.1,6.2,5.8,5.8,6.1,6,6.1,5.8,5.7,6,6.3,5.2,6.1,6.1,6,5.8,6.1,6.6,5.9,6.3,6,6.8,6.9,7.2,7.3,7.7,8.2,8.4,8.3,8.4,8.9,9.5,11,8.9,9,9.5,9.6,9.3,9.6,9.6,9.5,9.7,10.2,9.9,11.5,10.3,10.1,10.2,10.4,10.3,10.4,10.6,10.2,10.2,9.5,9.9,11,8.9,9.2,9.6,9.5,9.7,9.5,9.4,9.2,9.3,9,9.1,9,8.8,9.2,8.4,8.6,8.5,8.7,8.6,9.1,8.7,8.4,8.5,7.3,8,8.4,8,7.9,8.3,7.5,8.3,8.5,9.1,8.6,8.2,7.7,8.7,8.8,8.7,8.4,8.6,8.4,9,8.7,8.7,9.4,7.9,9,9.7,9.7,10.2,10.4,9.8,10.5,10.7,11.7,12.3,13.1,14.2,17.2,16,16.3,17.8,18.9,19.8,20.1,20,19.9,20.4,22.1,22.3,25.2,22.3,21,20.3,21.2,21,21.9,21.6,21.1,21.5,20.9,21.6,22.3,22,22.4,22,20.5,20.9,20.5,21,19.8,19.2,19.1,19.9,20.1,17.5,18.5,18.8,19.7,18.5,17.6,16.2,17.5,17.7,17.1,17,16.6,16.3,16.8,16.5,16.1,17,17,15.9,16.2,15.9,15.6,14.5,13.2,13.5,13.3,13.3,13.5,12.8,12.6,13.4,13.1,12.2,11.7],&#34;opacity&#34;:0.7,&#34;type&#34;:&#34;scatter3d&#34;,&#34;mode&#34;:&#34;markers&#34;,&#34;name&#34;:&#34;modelled values&#34;,&#34;marker&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;size&#34;:[55],&#34;sizemode&#34;:&#34;area&#34;,&#34;line&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;}},&#34;textfont&#34;:{&#34;size&#34;:55},&#34;error_y&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;error_x&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;line&#34;:{&#34;color&#34;:&#34;rgba(255,127,14,1)&#34;,&#34;width&#34;:55},&#34;frame&#34;:null}],&#34;highlight&#34;:{&#34;on&#34;:&#34;plotly_click&#34;,&#34;persistent&#34;:false,&#34;dynamic&#34;:false,&#34;selectize&#34;:false,&#34;opacityDim&#34;:0.2,&#34;selected&#34;:{&#34;opacity&#34;:1},&#34;debounce&#34;:0},&#34;base_url&#34;:&#34;https://plot.ly&#34;},&#34;evals&#34;:[&#34;config.modeBarButtonsToAdd.0.click&#34;],&#34;jsHooks&#34;:[]}&lt;/script&gt;
Look’s like random forrest models are pretty decent for non-linear regression!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>re-writing as.formula</title>
      <link>/2019/01/30/re-writing-as-formula/</link>
      <pubDate>Wed, 30 Jan 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/01/30/re-writing-as-formula/</guid>
      <description>


&lt;p&gt;The base r function as.formula uses R’s parsing rules, so it ignores white space, but cares about operators. That can lead to problems if the string it’s passed doesn’t obey those rules. For instance&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as.formula(&amp;quot;money ~ brains + looks&amp;quot;) # works&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## money ~ brains + looks&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;works fine, but&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as.formula(&amp;quot;gross-pay ~ min-wage + tips&amp;quot;) # doesn&amp;#39;t work&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## gross - pay ~ min - wage + tips&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;doesn’t work, because it confuses hyphens with minus signs.&lt;/p&gt;
&lt;p&gt;Let’s pause a minute and think of when we might want to use as.formula. A typical example might be when you want to experiment with different formulae on one dataset. e.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(purrr)
library(broom)
library(dplyr, warn.conflicts = FALSE)

mtcars %&amp;gt;% names %&amp;gt;%                   # get the names
      setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # take of mpg because that&amp;#39;s what we&amp;#39;ll model
      combn(3, simplify = FALSE) %&amp;gt;%   # get all combinations of 3 columns
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # make the rhs of the formula
      map_chr(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # add the lhs
      tibble(formula = .,                            
             model = formula %&amp;gt;% map(~lm(as.formula(.), data = mtcars)), # build models
             r_squared = model %&amp;gt;% map_dbl(. %&amp;gt;% glance %&amp;gt;% .$r.squared) # extract r.squred
            ) %&amp;gt;%
      arrange(desc(r_squared))  # find the best formulae&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 120 x 3
##    formula                 model    r_squared
##    &amp;lt;chr&amp;gt;                   &amp;lt;list&amp;gt;       &amp;lt;dbl&amp;gt;
##  1 mpg ~  wt + qsec + am   &amp;lt;S3: lm&amp;gt;     0.850
##  2 mpg ~  cyl + hp + wt    &amp;lt;S3: lm&amp;gt;     0.843
##  3 mpg ~  cyl + wt + carb  &amp;lt;S3: lm&amp;gt;     0.842
##  4 mpg ~  hp + wt + am     &amp;lt;S3: lm&amp;gt;     0.840
##  5 mpg ~  cyl + wt + qsec  &amp;lt;S3: lm&amp;gt;     0.840
##  6 mpg ~  drat + wt + qsec &amp;lt;S3: lm&amp;gt;     0.837
##  7 mpg ~  hp + drat + wt   &amp;lt;S3: lm&amp;gt;     0.837
##  8 mpg ~  hp + wt + gear   &amp;lt;S3: lm&amp;gt;     0.835
##  9 mpg ~  hp + wt + qsec   &amp;lt;S3: lm&amp;gt;     0.835
## 10 mpg ~  wt + qsec + gear &amp;lt;S3: lm&amp;gt;     0.833
## # … with 110 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;this is all well and good but imagine if the column names of mtcars were not so neat and tidy.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)
mtcars1 &amp;lt;- mtcars %&amp;gt;% rename(`q-sec` = qsec) 

mtcars1 %&amp;gt;% names %&amp;gt;% # mess up a name
  setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # same
      combn(3, simplify = FALSE) %&amp;gt;%   # code 
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # as
      map(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # before
      unlist %&amp;gt;%
      tibble(formula = ., 
             model = formula %&amp;gt;% map(~lm(as.formula(.), data = mtcars1)) 
            )&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in eval(predvars, data, env): object &amp;#39;sec&amp;#39; not found&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, let’s re-write as.formula&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(stringr)
library(rlang, warn.conflicts = FALSE)

as_formula &amp;lt;- function(string) {
  
  parts &amp;lt;- string %&amp;gt;% str_extract_all(&amp;quot;[A-Za-z\\-\\\\]+&amp;quot;) %&amp;gt;% .[[1]] %&amp;gt;% syms 
  target &amp;lt;- parts[[1]]
  inputs &amp;lt;- parts[-1]
  rhs &amp;lt;- inputs %&amp;gt;% reduce(~expr(!!.x + !!.y))
  expr(!!target ~ !!rhs)
  
    }

as_formula(&amp;quot;gross-pay ~ min-wage + tips&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `gross-pay` ~ `min-wage` + tips&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s just try it out on our previous example:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mtcars1 %&amp;gt;% names %&amp;gt;%                   # get the names
      setdiff(&amp;quot;mpg&amp;quot;) %&amp;gt;%               # take of mpg because that&amp;#39;s what we&amp;#39;ll model
      combn(3, simplify = FALSE) %&amp;gt;%   # get all combinations of 3 columns
      map(~ paste(., collapse = &amp;quot; + &amp;quot;)) %&amp;gt;%   # make the rhs of the formula
      map_chr(~ paste(&amp;quot;mpg ~ &amp;quot;, .)) %&amp;gt;%              # add the lhs
      tibble(formula = .,                            
             model = formula %&amp;gt;% map(~lm(as_formula(.), data = mtcars1)), # build models
             r_squared = model %&amp;gt;% map_dbl(. %&amp;gt;% glance %&amp;gt;% .$r.squared) # extract r.squred
            ) %&amp;gt;%
      arrange(desc(r_squared))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 120 x 3
##    formula                  model    r_squared
##    &amp;lt;chr&amp;gt;                    &amp;lt;list&amp;gt;       &amp;lt;dbl&amp;gt;
##  1 mpg ~  wt + q-sec + am   &amp;lt;S3: lm&amp;gt;     0.850
##  2 mpg ~  cyl + hp + wt     &amp;lt;S3: lm&amp;gt;     0.843
##  3 mpg ~  cyl + wt + carb   &amp;lt;S3: lm&amp;gt;     0.842
##  4 mpg ~  hp + wt + am      &amp;lt;S3: lm&amp;gt;     0.840
##  5 mpg ~  cyl + wt + q-sec  &amp;lt;S3: lm&amp;gt;     0.840
##  6 mpg ~  drat + wt + q-sec &amp;lt;S3: lm&amp;gt;     0.837
##  7 mpg ~  hp + drat + wt    &amp;lt;S3: lm&amp;gt;     0.837
##  8 mpg ~  hp + wt + gear    &amp;lt;S3: lm&amp;gt;     0.835
##  9 mpg ~  hp + wt + q-sec   &amp;lt;S3: lm&amp;gt;     0.835
## 10 mpg ~  wt + q-sec + gear &amp;lt;S3: lm&amp;gt;     0.833
## # … with 110 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, I admit it. This version of as.formula isn’t actually better than the original at all, because it can’t handle interaction terms, since it assumes you wants ’+’s on the rhs of your formula.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;as_formula(&amp;quot;bedtime ~ tiredness * coding&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## bedtime ~ tiredness + coding&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clearly isn’t correct. Nonetheless, it might be useful in the case when you have complex names and a simple linear model. Maybe it should be called as_linear_formula..&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About</title>
      <link>/about/</link>
      <pubDate>Sun, 27 Jan 2019 21:48:51 -0700</pubDate>
      
      <guid>/about/</guid>
      <description>&lt;p&gt;This is the person programming blog of Tom Greenwood (who after this introductory paragraph will henceforth refer to himself in the first person). Most probably, these posts will read as a series of attempts to run before learning to walk.&lt;/p&gt;

&lt;p&gt;It is built using the &lt;a href=&#34;https://github.com/rstudio/blogdown&#34;&gt;&lt;strong&gt;blogdown&lt;/strong&gt;&lt;/a&gt; package. The theme was forked from &lt;a href=&#34;https://github.com/jrutheiser/hugo-lithium-theme&#34;&gt;@jrutheiser/hugo-lithium-theme&lt;/a&gt; and modified by &lt;a href=&#34;https://github.com/yihui/hugo-lithium&#34;&gt;Yihui Xie&lt;/a&gt; and then actually modified a little bit more, by me.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>fun with map ( expr ) %&gt;% reduce </title>
      <link>/2019/01/27/metaprogramming-with-map-quo-reduce/</link>
      <pubDate>Sun, 27 Jan 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/01/27/metaprogramming-with-map-quo-reduce/</guid>
      <description>


&lt;p&gt;Ever since I discovered the rlang function ‘expr’ I have become mildy obsessed with the idea of writing code which writes code. This will be the first of probably many posts where I experiment with combining either iteration or recursion with non-standard evaluation. However, before launching into anything genuinely useful, some background is required:&lt;/p&gt;
&lt;p&gt;R is an ‘eagerly evaluated’ language, which means if you write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a &amp;lt;- 50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then just write a and hit enter you get:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This becomes problematic when you want one variable, let’s called it a, to hold the name of
another variable, b. If you write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a &amp;lt;- b&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in eval(expr, envir, enclos): object &amp;#39;b&amp;#39; not found&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You get an error, because r is eagerly trying to evaluate b, so that it can pass b’s value to a. That’s not r’s fault, that’s just the way it was built.&lt;/p&gt;
&lt;p&gt;Base r does have functions for preventing this, but I’m not even going to talk about those, since the functions from the rlang package are just better, so let’s talk about those instead. with rlang you can write:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rlang)
a &amp;lt;- expr(b)
a&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## b&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is nice. We haven’t even defined b yet, but we’re now allowed to tell r that a is b.
rlang also has a function for telling r to go get rid of the ‘expr’ and look underneath to find out what’s in b. The function is eval_tidy(). Let’s assign a value to b first, so that we won’t get an error.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;b &amp;lt;- &amp;quot;hey here&amp;quot;
eval_tidy(a)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;hey here&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Additionally, rlang provides a function for ‘unquoting’ i.e. which is essentially like evaluating but only one step down. To demonstrate this, let’s build a slightly bigger expression:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;c &amp;lt;- expr(d)
d &amp;lt;- &amp;quot; Tom&amp;quot;
e &amp;lt;- expr(paste(!!a, !!c, sep = &amp;quot;,&amp;quot;))
e&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## paste(b, d, sep = &amp;quot;,&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;eval_tidy(e)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;hey here, Tom&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, so you get the idea. We can build bigger expressions by unquoting smaller ones inside them. This is where things start to get interesting. One of the things I really hate writing is nested ifelse statements. It’s easy to make a typo and it just feels repetitive. Using map, expr and reduce we can write this function, which will write them for us.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# we&amp;#39;ll need the purrr package, for it&amp;#39;s map and reduce functions and if_else from dplyr
library(dplyr, warn.conflicts = FALSE)
library(purrr, warn.conflicts = FALSE)

build_ifelse &amp;lt;- function(mapping_list, col) { 
     
                  col &amp;lt;- enexpr(col)
                     
                  mapping_list %&amp;gt;% map(~ list(expr(!!col %in% !!.[[2]]), .[[1]] ) ) %&amp;gt;%
                { c(&amp;quot;other&amp;quot;, .) } %&amp;gt;%
                  reduce(~ expr(if_else(!!(.y[[1]]), !!(.y[[2]]), !!.x )))           
     
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If we define a mapping that we want to build our if_else statement upon (I always use if_else, rather than ifelse, not becaues it’s faster, but because you know what type you’ll get out)&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# define a mapping 
i = 1
numbers &amp;lt;- list()
pot &amp;lt;- seq(from = 1, to = (26*3), by = 1)
while (i &amp;lt;= 26) {
        numbers[[i]] &amp;lt;- sample(pot, 3)
        pot &amp;lt;- setdiff(pot, numbers %&amp;gt;% unlist)
        i &amp;lt;- i + 1
        }


mapping &amp;lt;- list(letters, numbers) %&amp;gt;%
                    transpose

# use the fuction to build the if_else statement
mapping_exp &amp;lt;- build_ifelse(mapping, number)

# have a look at it
mapping_exp&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## if_else(number %in% c(31, 25, 47), &amp;quot;z&amp;quot;, if_else(number %in% c(43, 
## 46, 12), &amp;quot;y&amp;quot;, if_else(number %in% c(32, 6, 61), &amp;quot;x&amp;quot;, if_else(number %in% 
##     c(67, 19, 10), &amp;quot;w&amp;quot;, if_else(number %in% c(11, 2, 48), &amp;quot;v&amp;quot;, 
##     if_else(number %in% c(27, 20, 69), &amp;quot;u&amp;quot;, if_else(number %in% 
##         c(60, 9, 55), &amp;quot;t&amp;quot;, if_else(number %in% c(62, 64, 17), 
##         &amp;quot;s&amp;quot;, if_else(number %in% c(38, 44, 58), &amp;quot;r&amp;quot;, if_else(number %in% 
##             c(78, 74, 35), &amp;quot;q&amp;quot;, if_else(number %in% c(1, 14, 
##         33), &amp;quot;p&amp;quot;, if_else(number %in% c(36, 23, 45), &amp;quot;o&amp;quot;, if_else(number %in% 
##             c(68, 26, 53), &amp;quot;n&amp;quot;, if_else(number %in% c(3, 72, 
##         18), &amp;quot;m&amp;quot;, if_else(number %in% c(66, 41, 76), &amp;quot;l&amp;quot;, if_else(number %in% 
##             c(59, 13, 50), &amp;quot;k&amp;quot;, if_else(number %in% c(75, 42, 
##         30), &amp;quot;j&amp;quot;, if_else(number %in% c(29, 73, 56), &amp;quot;i&amp;quot;, if_else(number %in% 
##             c(65, 21, 71), &amp;quot;h&amp;quot;, if_else(number %in% c(37, 22, 
##         40), &amp;quot;g&amp;quot;, if_else(number %in% c(24, 57, 52), &amp;quot;f&amp;quot;, if_else(number %in% 
##             c(51, 4, 39), &amp;quot;e&amp;quot;, if_else(number %in% c(34, 16, 
##         70), &amp;quot;d&amp;quot;, if_else(number %in% c(49, 54, 7), &amp;quot;c&amp;quot;, if_else(number %in% 
##             c(77, 63, 5), &amp;quot;b&amp;quot;, if_else(number %in% c(28, 8, 15
##         ), &amp;quot;a&amp;quot;, &amp;quot;other&amp;quot;))))))))))))))))))))))))))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think it’s fair to say that’s a bit of code you wouldn’t really want to write manually!&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# make a tbl with only numbers to test it on
number_tbl &amp;lt;- tibble(number = sample(1:120, 10))

# use the expression to find the right letter for each number
number_tbl %&amp;gt;% mutate(letter = !!mapping_exp)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    number letter
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt; 
##  1    106 other 
##  2      4 e     
##  3    112 other 
##  4     94 other 
##  5     17 s     
##  6    102 other 
##  7    103 other 
##  8     38 r     
##  9     13 k     
## 10     77 b&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Some provisos here: 1) Really you should use quo, not expr inside functions, because quo tracks its environment, and the fact that expr doesn’t can get you into a lot of trouble. So, the function should really be written:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;build_ifelse1 &amp;lt;- function(mapping_list, col) { 
     
                  col &amp;lt;- enquo(col)
                     
                  mapping_list %&amp;gt;% map(~ list(quo(!!col %in% !!.[[2]]), .[[1]] ) ) %&amp;gt;%
                { c(&amp;quot;other&amp;quot;, .) } %&amp;gt;%
                  reduce(~ quo(if_else(!!(.y[[1]]), !!(.y[[2]]), !!.x )))           
     
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The reasons I didn’t do it that way, for the purposes of this article is because the expression, when using quo is harder to read.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# use the fuction to build the if_else statement
mapping_exp1 &amp;lt;- build_ifelse1(mapping, number)

# have a look at it
mapping_exp1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## &amp;lt;quosure&amp;gt;
## expr: ^if_else(^(^number) %in% &amp;lt;dbl: 31, 25, 47&amp;gt;, &amp;quot;z&amp;quot;, ^if_else(^(^number)
##            %in% &amp;lt;dbl: 43, 46, 12&amp;gt;, &amp;quot;y&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 32, 6, 61&amp;gt;, &amp;quot;x&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 67, 19, 10&amp;gt;, &amp;quot;w&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 11, 2, 48&amp;gt;, &amp;quot;v&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 27, 20, 69&amp;gt;, &amp;quot;u&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 60, 9, 55&amp;gt;, &amp;quot;t&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 62, 64, 17&amp;gt;, &amp;quot;s&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 38, 44, 58&amp;gt;, &amp;quot;r&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 78, 74, 35&amp;gt;, &amp;quot;q&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 1, 14, 33&amp;gt;, &amp;quot;p&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 36, 23, 45&amp;gt;, &amp;quot;o&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 68, 26, 53&amp;gt;, &amp;quot;n&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 3, 72, 18&amp;gt;, &amp;quot;m&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 66, 41, 76&amp;gt;, &amp;quot;l&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 59, 13, 50&amp;gt;, &amp;quot;k&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 75, 42, 30&amp;gt;, &amp;quot;j&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 29, 73, 56&amp;gt;, &amp;quot;i&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 65, 21, 71&amp;gt;, &amp;quot;h&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 37, 22, 40&amp;gt;, &amp;quot;g&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 24, 57, 52&amp;gt;, &amp;quot;f&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 51, 4, 39&amp;gt;, &amp;quot;e&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 34, 16, 70&amp;gt;, &amp;quot;d&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 49, 54, 7&amp;gt;, &amp;quot;c&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 77, 63, 5&amp;gt;, &amp;quot;b&amp;quot;, ^if_else(^(^number)
##             %in% &amp;lt;dbl: 28, 8, 15&amp;gt;, &amp;quot;a&amp;quot;, &amp;quot;other&amp;quot;))))))))))))))))))))))))))
## env:  0x558a2ecc3da8&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Yeah, I can’t read that either.&lt;/p&gt;
&lt;p&gt;Proviso 2) As one of my colleagues pointed out; for this particular example, you can do it more easily with a join:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyr, warn.conflicts = FALSE)
tibble(letter = letters, number = numbers) %&amp;gt;% 
            unnest %&amp;gt;% 
            { left_join(number_tbl, .)}&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = &amp;quot;number&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    number letter
##     &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; 
##  1    106 &amp;lt;NA&amp;gt;  
##  2      4 e     
##  3    112 &amp;lt;NA&amp;gt;  
##  4     94 &amp;lt;NA&amp;gt;  
##  5     17 s     
##  6    102 &amp;lt;NA&amp;gt;  
##  7    103 &amp;lt;NA&amp;gt;  
##  8     38 r     
##  9     13 k     
## 10     77 b&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Which would have saved some time, but then you wouldn’t have had the pleasure of seeing that massive if_else statement the computer wrote for you, so, pros and cons I guess. I’m
sure there must be some case where you couldn’t unnest, so you’d need the if_else.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
